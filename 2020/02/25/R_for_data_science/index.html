<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Data visualisation我们先来看一个例子，有着大引擎的汽车是否比小引擎的汽车消耗的油要多？ 我们可以用ggplot2包中的mpg数据： 12ggplot(data&#x3D;map)+   geom_point(mapping&#x3D;aes(x&#x3D;displ,y&#x3D;hwy))   从图上看，引擎大小与燃油效率成负相关的关系 首先ggplot()指定绘图的数据集，并创建了一个空的画布；geom_point">
<meta property="og:type" content="article">
<meta property="og:title" content="R_for_data_science">
<meta property="og:url" content="http://yoursite.com/2020/02/25/R_for_data_science/index.html">
<meta property="og:site_name" content="Wutao&#39;s Blog">
<meta property="og:description" content="Data visualisation我们先来看一个例子，有着大引擎的汽车是否比小引擎的汽车消耗的油要多？ 我们可以用ggplot2包中的mpg数据： 12ggplot(data&#x3D;map)+   geom_point(mapping&#x3D;aes(x&#x3D;displ,y&#x3D;hwy))   从图上看，引擎大小与燃油效率成负相关的关系 首先ggplot()指定绘图的数据集，并创建了一个空的画布；geom_point">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/2020_1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/2020_2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.26.47.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.34.05.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.38.13.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.56.31.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%887.00.19.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%887.59.52.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.17.58.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.18.26.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.19.09.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.20.49.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.21.24.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.44.34.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%889.05.48.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%889.09.09.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200213104000.png">
<meta property="og:image" content="c:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200213104459858.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200218101737.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220104342.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220104509.png">
<meta property="og:image" content="c:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220112633090.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220113155.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220113915.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220114455.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220152523.png">
<meta property="og:image" content="c:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220152713888.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220153824.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220153853.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220154137.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220161102.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220161121.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220161727.png">
<meta property="og:image" content="c:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220164440071.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220164709.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220165848.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220170241.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220170511.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220170811.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220171306.png">
<meta property="og:image" content="c:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220180652299.png">
<meta property="og:image" content="c:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220181714726.png">
<meta property="og:image" content="c:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220183132809.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200123164654.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201100436.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201111417.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201111534.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201111909.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200212190839.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200212190723.png">
<meta property="og:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200225135247.png">
<meta property="article:published_time" content="2020-02-25T07:49:36.570Z">
<meta property="article:modified_time" content="2020-02-25T10:50:40.106Z">
<meta property="article:author" content="Wu tao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wt12318/picgo/master/2020_1.png">

<link rel="canonical" href="http://yoursite.com/2020/02/25/R_for_data_science/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>R_for_data_science | Wutao's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wutao's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle"><script type="text/javascript" src="https://api.imjad.cn/hitokoto/?cat=&charset=utf-8&length=50&encode=js&fun=sync&source="></script><div id="hitokoto"><script>hitokoto()</script></p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/25/R_for_data_science/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Wu tao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wutao's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          R_for_data_science
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-02-25 15:49:36 / 修改时间：18:50:40" itemprop="dateCreated datePublished" datetime="2020-02-25T15:49:36+08:00">2020-02-25</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Data-visualisation"><a href="#Data-visualisation" class="headerlink" title="Data visualisation"></a>Data visualisation</h1><p>我们先来看一个例子，有着大引擎的汽车是否比小引擎的汽车消耗的油要多？</p>
<p>我们可以用<code>ggplot2</code>包中的mpg数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=map)+</span><br><span class="line">   geom_point(mapping=aes(x=displ,y=hwy))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/2020_1.png" alt=""></p>
<p>从图上看，引擎大小与燃油效率成负相关的关系</p>
<p>首先<code>ggplot()</code>指定绘图的数据集，并创建了一个空的画布；<code>geom_point()</code>在这个空画布的基础上添加了一个散点图的图层，mapping参数定义了数据集中的参数是如何和图中的特征联系在一起，在这里将两个变量给了坐标轴</p>
<p>我们首先来看<code>mapping</code></p>
<a id="more"></a>

<h2 id="Aesthetic-mappings"><a href="#Aesthetic-mappings" class="headerlink" title="Aesthetic mappings"></a>Aesthetic mappings</h2><blockquote>
<p>“The greatest value of a picture is when it forces us to notice what we never expected to see.” — John Tukey</p>
</blockquote>
<p>美学–图中对象的可视化特征，用level来表示，如一个点的大小，形状，颜色等</p>
<p>比如，我们可以利用点的颜色在上面的二维图中加入一个新的维度，class</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,color=class))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/2020_2.png" alt=""></p>
<p>为了把一个美学的元素“map“到一个变量上，得在<code>aes()</code>里将美学元素的名称和变量的名称绑定到一起。ggplot2就会自动地将美学元素的每一个level（这里是每一种颜色）分配给变量的每一个值，这个过程叫做<strong>scaling</strong>,并且会添加一个图例解释level和value之间的对应关系</p>
<p>我们也可以将class map到不同的美学元素上，例如<code>size</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,size=class))</span><br><span class="line"><span class="comment">##Warning message:</span></span><br><span class="line"><span class="comment">##Using size for a discrete variable is not advised.</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.26.47.png" alt=""></p>
<p>会出现一个warning，因为我们将一个无序的变量class map到一个有序的美学元素size上了</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mapping class to alpha(transparency)</span></span><br><span class="line">ggplot(data=mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,alpha=class))</span><br><span class="line"><span class="comment">#Warning message:</span></span><br><span class="line"><span class="comment">#Using alpha for a discrete variable is not advised. </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mapping class to shape</span></span><br><span class="line">ggplot(data=mpg)+</span><br><span class="line">  geom_point(mapping=aes(x=displ,y=hwy,shape=class))</span><br><span class="line"><span class="comment">#Warning messages:</span></span><br><span class="line"><span class="comment">#1: The shape palette can deal with a maximum of 6</span></span><br><span class="line"><span class="comment">#discrete values because more than 6 becomes difficult</span></span><br><span class="line"><span class="comment">#to discriminate; you have 7. Consider specifying</span></span><br><span class="line"><span class="comment">#shapes manually if you must have them. </span></span><br><span class="line"><span class="comment">#2: Removed 62 rows containing missing values (geom_point).</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.34.05.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.38.13.png" alt=""></p>
<p>ggplot2一次只能使用6种形状，多于6种形状的变量值就不画了</p>
<p>x，y的坐标本身也是一种美学元素，这里的图例就是坐标轴，其显示了变量的值和位置之间的mapping关系</p>
<p>我们也可以手动设定美学元素的值，这个时候就要放到<code>aes()</code>的外面，表示其不是和变量联系的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy),color=<span class="string">"blue"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%886.56.31.png" alt=""></p>
<p>这个时候我们就要注意美学元素的取值：</p>
<ul>
<li>color：字符串</li>
<li>size ： 毫米数值</li>
<li>shape：整数<img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%887.00.19.png" alt=""></li>
</ul>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>在<code>mpg</code>中哪些变量是类别型的变量，哪些是连续型的变量</p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%887.59.52.png" alt=""></p>
</blockquote>
<p>分类变量有model，trans,drv,fl,class</p>
<p>连续变量有displ,year,cyl,cty,hwy</p>
<p>我们也可以用<code>glimpse()</code>来显示数据框的结构</p>
<blockquote>
<p>将连续型变量和类别变量map到color，size，shape，等美学元素上，他们的行为有什么不同？</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,color=trans))</span><br><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,color=cyl))</span><br><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,size=trans))</span><br><span class="line"><span class="comment">##Warning message:</span></span><br><span class="line"><span class="comment">##Using size for a discrete variable is not advised.</span></span><br><span class="line">plot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,size=cyl))</span><br><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,shape=trans))</span><br><span class="line"><span class="comment">##Warning messages:</span></span><br><span class="line"><span class="comment">##1: The shape palette can deal with a maximum of 6</span></span><br><span class="line"><span class="comment">##discrete values because more than 6 becomes</span></span><br><span class="line"><span class="comment">##difficult to discriminate; you have 10. Consider</span></span><br><span class="line"><span class="comment">##specifying shapes manually if you must have</span></span><br><span class="line"><span class="comment">##them. </span></span><br><span class="line"><span class="comment">##2: Removed 96 rows containing missing values</span></span><br><span class="line"><span class="comment">##(geom_point).</span></span><br><span class="line"></span><br><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,shape=cyl))</span><br><span class="line"><span class="comment">#错误: A continuous variable can not be mapped to shape</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.17.58.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.18.26.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.19.09.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.20.49.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.21.24.png" alt=""></p>
<p>不能将一个连续型变量map到shape上</p>
<blockquote>
<p>当把一个变量map到多个美学元素上会发生什么？</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,color=cyl,size=cyl))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%888.44.34.png" alt=""></p>
<p>当把多个变量map到一个美学元素上时会显示冗余的信息，用处不大</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">我们可以使用&#96;&#96;&#96;vignette(&quot;ggplot2-specs&quot;)&#96;&#96;&#96;来查看具体的美学元素,文档里说明了，对于形状21-24，其填充的大小由&#96;&#96;&#96;size&#96;&#96;&#96;控制，边缘的大小则由&#96;&#96;&#96;stroke&#96;&#96;&#96;控制</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">a &lt;- data.frame(size&#x3D;c(3,3,3,4,4,4,5,5,5,6,6,6),stroke&#x3D;c(3,4,5,3,4,5,3,4,5,3,4,5))</span><br><span class="line">ggplot(data &#x3D; a)+</span><br><span class="line"> geom_point(mapping &#x3D; aes(x&#x3D;size,y&#x3D;stroke,size&#x3D;size,stroke&#x3D;stroke),shape&#x3D;21,fill&#x3D;&quot;red&quot;) </span><br></pre></td></tr></table></figure>
</blockquote>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%889.05.48.png" alt=""></p>
<blockquote>
<p>What happens if you map an aesthetic to something other than a variable name, like <code>aes(colour = displ &lt; 5)</code>? Note, you’ll also need to specify x and y.</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg)+</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy,color=displ&lt;<span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/%E6%88%AA%E5%B1%8F2020-01-11%E4%B8%8B%E5%8D%889.09.09.png" alt=""></p>
<h2 id="Facts"><a href="#Facts" class="headerlink" title="Facts"></a>Facts</h2><p>对于一些离散的分类变量，除了将其分配给美学元素外，还可以分开画图，可以用<code>facet_wrap()</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  facet_wrap(~class,nrow = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200213104000.png" alt=""></p>
<p>也可以根据两个变量来分开画，用<code>facet_grid()</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  facet_grid(drv~cyl)<span class="comment">##~前面是row，后面是col</span></span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200213104459858.png" alt="image-20200213104459858"></p>
<p>下面两个是一样的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  facet_grid(.~cyl)<span class="comment">##or facet_grid(cols=vars(cyl))</span></span><br><span class="line"></span><br><span class="line">ggplot(data = mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  facet_wrap(~cyl,nrow = <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>What happens if you facet on a continuous variable?</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  facet_wrap(~cty)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200218101737.png" alt=""></p>
<p>所以，如果对一个连续型的变量进行<code>facet_wrap()</code>会将连续变量转化成分类变量对每个值画图</p>
<h2 id="Geometric-objects"><a href="#Geometric-objects" class="headerlink" title="Geometric objects"></a>Geometric objects</h2><p>同一个数据可以用不同的形式表现出来，这个不同的表现形式在<code>ggplot2</code>中叫做<code>geoms</code></p>
<p>比如：下面两幅图，一个是<code>points geom</code>，一个是<code>smooth line geom</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##point geoms</span></span><br><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy))</span><br><span class="line"></span><br><span class="line"><span class="comment">##smooth geoms</span></span><br><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_smooth(mapping = aes(x=displ,y=hwy))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220104342.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220104509.png" alt=""></p>
<p><code>ggplot2</code>提供了超过40种<code>geoms</code>,另外还有很多的拓展包也提供了更多的<code>geoms</code> <a href="https://www.ggplot2-exts.org/" target="_blank" rel="noopener">packages</a></p>
<p>很多<code>geoms</code>利用一种几何对象来描述一个数据的不同类别，可以使用<code>group</code>将分类变量<code>map</code>到该美学对象上，并且是显示<code>legend</code>的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">par(mfcol=c(<span class="number">1</span>,<span class="number">3</span>))</span><br><span class="line">p1 &lt;- ggplot(data=mpg) +</span><br><span class="line">  geom_smooth(mapping = aes(x=displ,y=hwy))</span><br><span class="line">p2 &lt;- ggplot(data=mpg) +</span><br><span class="line">  geom_smooth(mapping = aes(x=displ,y=hwy,group=drv))</span><br><span class="line">p3 &lt;- ggplot(data=mpg) +</span><br><span class="line">  geom_smooth(</span><br><span class="line">    mapping = aes(x=displ,y=hwy,color=drv),</span><br><span class="line">    show.legend = <span class="literal">F</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">multiplot(p1,p2,p3,cols = <span class="number">3</span>)</span><br></pre></td></tr></table></figure>



<p><img src="C:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220112633090.png" alt="image-20200220112633090"></p>
<p>我们也可以将多个<code>geoms</code>展示在一个图中,使用<code>+</code>：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  geom_smooth(mapping=aes(x=displ,y=hwy))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220113155.png" alt=""></p>
<p>但是如果我们像上面那样将多个<code>geoms</code>在一个图中展示，当我们想要改变展示的变量的时候，就可能漏掉某个<code>geom</code>，所以我们可以将在每个<code>geom</code>中的选项移到<code>ggplot</code>中，相当于定义了全局的’’参数’’:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##这个效果和上面的是一样的</span></span><br><span class="line">ggplot(data=mpg,mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  geom_point() +</span><br><span class="line">  geom_smooth()</span><br></pre></td></tr></table></figure>

<p>并且对每个<code>geom</code>还可以定义<code>mapping</code>的美学元素，相当于’’局部参数’’</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg,mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  geom_point(mapping = aes(color=class)) +</span><br><span class="line">  geom_smooth()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220113915.png" alt=""></p>
<p>类似的，我们也可以对不同的<code>geom</code>让其展示不同的数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg,mapping = aes(x=displ,y=hwy)) +</span><br><span class="line">  geom_point(mapping = aes(color=class)) +</span><br><span class="line">  geom_smooth(data = filter(mpg,class==<span class="string">"subcompact"</span>),se=<span class="literal">F</span>)</span><br><span class="line"><span class="comment">##这里，曲线就是拟合了紫色的数据</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220114455.png" alt=""></p>
<h3 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h3><h2 id="Statistical-transformations"><a href="#Statistical-transformations" class="headerlink" title="Statistical transformations"></a>Statistical transformations</h2><p>我们现在来看柱状图，用的数据是<code>ggplot2</code>的<code>diamonds</code>数据<img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220152523.png" alt=""></p>
<p>我们来画一个柱状图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut))</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220152713888.png" alt="image-20200220152713888"></p>
<p>可以看到，x轴是数据中的<code>cut</code>变量，但是y轴并不是原始数据中的变量，其实有很多图也有相似的行为：</p>
<ul>
<li><p>柱形图(bar chart) ,直方图(histogram),频数多边形图(freqyuency polygon)(这三者的区别是什么？)将数据分组(bins),然后算在每一组的counts</p>
<ul>
<li><p>柱形图和直方图的差别在于：柱形图的X轴是分类变量，并且一般有间隔，而直方图是数量(连续变量)，一般没有间隔</p>
</li>
<li><p>频数多边形与直方图的区别在于多边形图没有bar是用折线连接的</p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220153824.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220153853.png" alt=""></p>
</li>
</ul>
</li>
<li><p>平滑的曲线图给数据拟合了一个模型，然后画出了对该模型的预测</p>
</li>
<li><p>箱线图给出了对数据分布的summary</p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220154137.png" alt=""></p>
<p>所以就是<code>geom_bar()</code>有一个默认的<code>stat</code>参数就是<code>count</code></p>
<p>更进一步来说就是，每一个<code>geom</code>都有一个默认的<code>stat</code>，每一个<code>stat</code>都有一个默认的<code>geom</code>，所以一下两个的结果是一样的：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut))</span><br><span class="line">ggplot(data=diamonds) +</span><br><span class="line">  stat_count(mapping = aes(x=cut))</span><br></pre></td></tr></table></figure>

<p>当然，我们也可以改变默认的值</p>
<ul>
<li><p>我们想要bar代表一个变量而不是x的数量，可以将<code>geom_bar</code>的<code>stat</code>由默认的<code>count</code>改成<code>identity</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">demo &lt;- tribble(</span><br><span class="line">  ~cut,         ~freq,</span><br><span class="line">  <span class="string">"Fair"</span>,       <span class="number">1610</span>,</span><br><span class="line">  <span class="string">"Good"</span>,       <span class="number">4906</span>,</span><br><span class="line">  <span class="string">"Very Good"</span>,  <span class="number">12082</span>,</span><br><span class="line">  <span class="string">"Premium"</span>,    <span class="number">13791</span>,</span><br><span class="line">  <span class="string">"Ideal"</span>,      <span class="number">21551</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ggplot(data = demo) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, y = freq), stat = <span class="string">"identity"</span>)</span><br><span class="line">ggplot(data = demo) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220161102.png" alt=""></p>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220161121.png" alt=""></p>
<ul>
<li><p>也可以将其算的变量直接mapping到y轴：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut,y=stat(prop),group=<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220161727.png" alt=""></p>
</li>
</ul>
<h3 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h3><h2 id="Position-adjustments"><a href="#Position-adjustments" class="headerlink" title="Position adjustments"></a>Position adjustments</h2><p>对于柱状图还有一个比较有用的美学元素：<code>fill</code>来添加颜色，而<code>colour</code>只对边框添加颜色：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut,colour=cut))</span><br><span class="line">p2 &lt;- ggplot(data=diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut,fill=cut))</span><br><span class="line">multiplot(p1,p2,cols = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220164440071.png" alt="image-20200220164440071"></p>
<p>当我们把<code>fill</code>map到另一个变量，那么就会产生堆叠的图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut,fill=clarity))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220164709.png" alt=""></p>
<p>这个堆叠的行为是由<code>position adjustment</code>来控制的，也就是<code>position</code>参数，有”identity”,”dodge”,”fill”选项</p>
<ul>
<li><p><code>position=&quot;identity&quot;</code>就是把对象放在其原来的位置上，这对bars用处不大，因为这些对象和bar是重叠的，我们可以设置透明度来看到这个重叠的对象</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;-ggplot(data = diamonds,mapping = aes(x=cut,fill=clarity)) +</span><br><span class="line">  geom_bar(alpha=<span class="number">1</span>/<span class="number">5</span>,position = <span class="string">"identity"</span>)</span><br><span class="line">p2 &lt;- ggplot(data = diamonds,mapping = aes(x=cut,colour=clarity)) +</span><br><span class="line">  geom_bar(fill=<span class="literal">NA</span>,position = <span class="string">"identity"</span>)</span><br><span class="line">multiplot(p1,p2,cols = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220165848.png" alt=""></p>
<p>所以<code>identity</code>对二维的图更有用处，所以该参数在散点图中是默认值</p>
</li>
<li><p><code>position=&quot;fill&quot;</code> 也是堆叠，但是其将每个bar的高度设置为一样的，所以比较不同的类之间的比例比较方便</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut,fill=clarity),position = <span class="string">"fill"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220170241.png" alt=""></p>
</li>
<li><p><code>position=&quot;dodge&quot;</code> 将重叠的对象并排放置，方便比较</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut,fill=clarity),position = <span class="string">"dodge"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220170511.png" alt=""></p>
</li>
</ul>
<p>  还有一个类型的<code>position adjustment</code>，但是对柱状图没什么用处，对点图有用：</p>
  <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy))</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220170811.png" alt=""></p>
<p>我们可以数出来图中只有126个点，但是我们有234个观测值，因为<code>hwy</code>和<code>displ</code>的值被近似的，就会导致一些值就会重合，那怎么避免这个问题呢，我们可以用<code>position=&quot;jitter&quot;</code> ,这个参数对每一个点加了一个随机的非常小的noise进去，所以两个点就可以分开了</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data=mpg) +</span><br><span class="line">  geom_point(mapping = aes(x=displ,y=hwy),position = <span class="string">"jitter"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200220171306.png" alt=""></p>
<h3 id="练习-4"><a href="#练习-4" class="headerlink" title="练习"></a>练习</h3><h2 id="Coordinate-systems"><a href="#Coordinate-systems" class="headerlink" title="Coordinate systems"></a>Coordinate systems</h2><p>默认的坐标系统是笛卡尔坐标，即由x，y来决定每个点的位置，也有一些其他的坐标系统：</p>
<ul>
<li><p><code>coord_filp()</code>将x轴，y轴调换了，这样做是有用处的，比如想画一个水平的boxplot或者但我们的lable太长，放在x轴会重叠</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- ggplot(data=mpg,mapping = aes(x=class,y=hwy)) +</span><br><span class="line">  geom_boxplot()</span><br><span class="line">p2 &lt;- ggplot(data=mpg,mapping = aes(x=class,y=hwy)) +</span><br><span class="line">  geom_boxplot() +</span><br><span class="line">  coord_flip()</span><br><span class="line">multiplot(p1,p2,cols = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220180652299.png" alt="image-20200220180652299"></p>
</li>
<li><p><code>coord_quickmap()</code>设置正确的长宽比</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p1 &lt;- ggplot(nz,aes(x=long,y=lat,group=group)) +</span><br><span class="line">  geom_polygon(fill=<span class="string">"white"</span>,colour=<span class="string">"red"</span>)</span><br><span class="line">p2 &lt;- ggplot(nz,aes(x=long,y=lat,group=group)) +</span><br><span class="line">  geom_polygon(fill=<span class="string">"white"</span>,colour=<span class="string">"red"</span>) +</span><br><span class="line">  coord_quickmap()</span><br><span class="line">multiplot(p1,p2,cols = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220181714726.png" alt="image-20200220181714726"></p>
</li>
<li><p><code>coord_polar()</code>使用极坐标，通过极坐标bar chart和coxcomb chart(这种图每个部分的角度是一样的，但是每个部分的面积表示了该部分的值的多少)之间就能建立联系</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bar &lt;- ggplot(data=diamonds) +</span><br><span class="line">  geom_bar(</span><br><span class="line">    mapping = aes(x=cut,fill=cut),</span><br><span class="line">    show.legend = <span class="literal">F</span></span><br><span class="line">  ) +</span><br><span class="line">  theme(aspect.ratio = <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p1 &lt;- bar +coord_flip()</span><br><span class="line">p2 &lt;- bar +coord_polar()</span><br><span class="line">multiplot(p1,p2,cols = <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C16504%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200220183132809.png" alt="image-20200220183132809"></p>
</li>
</ul>
<h3 id="练习-5"><a href="#练习-5" class="headerlink" title="练习"></a>练习</h3><h2 id="The-layered-grammar-of-graphics"><a href="#The-layered-grammar-of-graphics" class="headerlink" title="The layered grammar of graphics"></a>The layered grammar of graphics</h2><p>现在我们可以将我们的作图模板归纳为：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = &lt;DATA&gt;) + </span><br><span class="line">  &lt;GEOM_FUNCTION&gt;(</span><br><span class="line">     mapping = aes(&lt;MAPPINGS&gt;),</span><br><span class="line">     stat = &lt;STAT&gt;, </span><br><span class="line">     position = &lt;POSITION&gt;</span><br><span class="line">  ) +</span><br><span class="line">  &lt;COORDINATE_FUNCTION&gt; +</span><br><span class="line">  &lt;FACET_FUNCTION&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Data-transformation"><a href="#Data-transformation" class="headerlink" title="Data transformation"></a>Data transformation</h1><p>在这一章里我们主要学习如何使用<code>dplyr</code>包，使用的数据主要来源于<code>nycflights13</code>包，这个数据是2013年离开New York的336776个航班</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flights</span><br><span class="line"><span class="comment">#&gt; # A tibble: 336,776 x 19</span></span><br><span class="line"><span class="comment">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span></span><br><span class="line"><span class="comment">#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span></span><br><span class="line"><span class="comment">#&gt; 1  2013     1     1      517            515         2      830</span></span><br><span class="line"><span class="comment">#&gt; 2  2013     1     1      533            529         4      850</span></span><br><span class="line"><span class="comment">#&gt; 3  2013     1     1      542            540         2      923</span></span><br><span class="line"><span class="comment">#&gt; 4  2013     1     1      544            545        -1     1004</span></span><br><span class="line"><span class="comment">#&gt; 5  2013     1     1      554            600        -6      812</span></span><br><span class="line"><span class="comment">#&gt; 6  2013     1     1      554            558        -4      740</span></span><br><span class="line"><span class="comment">#&gt; # … with 3.368e+05 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#&gt; #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#&gt; #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#&gt; #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<p>这种数据的展现形式和常见的<code>view(flights)</code>有所不同，这种方式叫做<code>tibble</code>，更加的简洁，展示的信息更丰富</p>
<p>在每一列下面的3个或者4个字母的缩写表示的意思：</p>
<ul>
<li><code>int</code>表示整数类型</li>
<li><code>dbl</code>表示双精度或者实数类型</li>
<li><code>chr</code>表示字符向量或者字符串</li>
<li><code>dttm</code>表示日期，时间</li>
<li><code>lgl</code>表示逻辑值</li>
<li><code>fctr</code>表示因子，用来展示分类变量</li>
<li><code>date</code>表示日期</li>
</ul>
<p>这章主要学习<code>dplyr</code>的5个函数</p>
<ul>
<li><code>filter()</code></li>
<li><code>arrange()</code></li>
<li><code>select()</code></li>
<li><code>mutate()</code></li>
<li><code>summarise()</code></li>
</ul>
<p>这些函数的使用都比较相似：第一个参数是一个数据框，接下来的参数是对数据框的操作（不带引号），结果是一个新的数据框</p>
<h2 id="使用filter-来过滤行"><a href="#使用filter-来过滤行" class="headerlink" title="使用filter()来过滤行"></a>使用<code>filter()</code>来过滤行</h2><p>第一个参数是数据框，第二个和随后的参数是用来过滤数据框的表达式：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(nycflights13)</span><br><span class="line"><span class="keyword">library</span>(tidyverse)</span><br><span class="line"><span class="comment">##select all filghts on January 1st</span></span><br><span class="line">filter(flights,month==<span class="number">1</span>,day==<span class="number">1</span>)</span><br><span class="line"><span class="comment"># A tibble: 842 x 19</span></span><br><span class="line">    year month   day dep_time sched_dep_time</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>            <span class="number">515</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>            <span class="number">529</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>            <span class="number">540</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>            <span class="number">545</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">558</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>            <span class="number">600</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>            <span class="number">600</span></span><br><span class="line"><span class="comment"># ... with 832 more rows, and 14 more variables:</span></span><br><span class="line"><span class="comment">#   dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Comparisons"><a href="#Comparisons" class="headerlink" title="Comparisons"></a>Comparisons</h3><p>用比较运算符来过滤数据：<code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>!=</code> (not equal), and <code>==</code> (equal).</p>
<p>注意，当我们对数字进行比较的时候，用这些运算符可能会出错，特别是浮点数（开方，除会出现）和整数比较的时候：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sqrt(<span class="number">2</span>)^<span class="number">2</span> ==<span class="number">2</span></span><br><span class="line"><span class="comment">#[1] FALSE</span></span><br><span class="line">sqrt(<span class="number">2</span>)^<span class="number">2</span></span><br><span class="line"><span class="comment">#[1] 2</span></span><br><span class="line"><span class="number">1</span>/<span class="number">49</span>*<span class="number">49</span> == <span class="number">1</span></span><br><span class="line"><span class="comment">#[1] FALSE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##这个时候，我们就需要使用near()</span></span><br><span class="line">near(sqrt(<span class="number">2</span>)^<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">#[1] TRUE</span></span><br><span class="line">near(<span class="number">1</span>/<span class="number">49</span>*<span class="number">49</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment">#[1] TRUE</span></span><br></pre></td></tr></table></figure>

<h3 id="Logical-operators"><a href="#Logical-operators" class="headerlink" title="Logical operators"></a>Logical operators</h3><p>使用布尔操作符来过滤数据：<code>&amp;</code> is “and”, <code>|</code> is “or”, and <code>!</code> is “not”. </p>
<p>注意，当我们写一个复杂的表达式的时候要注意布尔表达式的作用范围，我们可以使用De Morgan定律来简化表达式：<code>!(x &amp; y)</code> = <code>!x | !y</code>, and <code>!(x | y)</code> =<code>!x &amp; !y</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##选择延误不超过2个小时的航班（包括到达延误和起飞延误）</span></span><br><span class="line">filter(flights,!(arr_delay&gt;<span class="number">120</span> | dep_delay&gt;<span class="number">120</span>))</span><br><span class="line">filter(flights,arr_delay&lt;<span class="number">120</span>,dep_delay&lt;<span class="number">120</span>)</span><br><span class="line">filter(flights,arr_delay&lt;<span class="number">120</span>&amp;dep_delay&lt;<span class="number">120</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A tibble: 316,050 x 19</span></span><br><span class="line">    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>            <span class="number">515</span>         <span class="number">2</span>      <span class="number">830</span>            <span class="number">819</span>        <span class="number">11</span> UA        <span class="number">1545</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>            <span class="number">529</span>         <span class="number">4</span>      <span class="number">850</span>            <span class="number">830</span>        <span class="number">20</span> UA        <span class="number">1714</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>            <span class="number">540</span>         <span class="number">2</span>      <span class="number">923</span>            <span class="number">850</span>        <span class="number">33</span> AA        <span class="number">1141</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>            <span class="number">545</span>        -<span class="number">1</span>     <span class="number">1004</span>           <span class="number">1022</span>       -<span class="number">18</span> B6         <span class="number">725</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span>      <span class="number">812</span>            <span class="number">837</span>       -<span class="number">25</span> DL         <span class="number">461</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">558</span>        -<span class="number">4</span>      <span class="number">740</span>            <span class="number">728</span>        <span class="number">12</span> UA        <span class="number">1696</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>            <span class="number">600</span>        -<span class="number">5</span>      <span class="number">913</span>            <span class="number">854</span>        <span class="number">19</span> B6         <span class="number">507</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span>      <span class="number">709</span>            <span class="number">723</span>       -<span class="number">14</span> EV        <span class="number">5708</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span>      <span class="number">838</span>            <span class="number">846</span>        -<span class="number">8</span> B6          <span class="number">79</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>            <span class="number">600</span>        -<span class="number">2</span>      <span class="number">753</span>            <span class="number">745</span>         <span class="number">8</span> AA         <span class="number">301</span></span><br><span class="line"><span class="comment"># ... with 316,040 more rows, and 8 more variables: tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<p>还要注意，对一个变量进行过滤的时候，要将两个变量的名字都写出来：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">filter(flights,month==<span class="number">11</span> | month==<span class="number">12</span>)</span><br><span class="line">filter(flights,month==<span class="number">11</span> | <span class="number">12</span>)<span class="comment">##这个其实我们选的是一月，因为11 | 12 的值是TRUE，在表示数字的时候，TRUE就等于1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##或者我们使用%in%</span></span><br><span class="line">filter(flights,month %<span class="keyword">in</span>% c(<span class="number">11</span>,<span class="number">12</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># A tibble: 55,403 x 19</span></span><br><span class="line">    year month   day dep_time sched_dep_time dep_delay arr_time</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>        <span class="number">5</span>           <span class="number">2359</span>         <span class="number">6</span>      <span class="number">352</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>       <span class="number">35</span>           <span class="number">2250</span>       <span class="number">105</span>      <span class="number">123</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">455</span>            <span class="number">500</span>        -<span class="number">5</span>      <span class="number">641</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">539</span>            <span class="number">545</span>        -<span class="number">6</span>      <span class="number">856</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">542</span>            <span class="number">545</span>        -<span class="number">3</span>      <span class="number">831</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">549</span>            <span class="number">600</span>       -<span class="number">11</span>      <span class="number">912</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">550</span>            <span class="number">600</span>       -<span class="number">10</span>      <span class="number">705</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span>      <span class="number">659</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span>      <span class="number">826</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>    <span class="number">11</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span>      <span class="number">749</span></span><br><span class="line"><span class="comment"># ... with 55,393 more rows, and 12 more variables:</span></span><br><span class="line"><span class="comment">#   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Missing-values"><a href="#Missing-values" class="headerlink" title="Missing values"></a>Missing values</h3><p>NA是具有”传染性的”，当我们计算或者比较中包含NA，那么结果也会是NA:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">NA</span> &gt; <span class="number">5</span></span><br><span class="line"><span class="comment">#[1] NA</span></span><br><span class="line"><span class="number">10</span> == <span class="literal">NA</span></span><br><span class="line"><span class="comment">#[1] NA</span></span><br><span class="line"><span class="literal">NA</span> + <span class="number">10</span></span><br><span class="line"><span class="comment">#[1] NA</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><figcaption><span>：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">df &lt;- tibble(x&#x3D;c(1,NA,3),y&#x3D;c(NA,2,4))</span><br><span class="line">df</span><br><span class="line"># A tibble: 3 x 2</span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">1     1    NA</span><br><span class="line">2    NA     2</span><br><span class="line">3     3     4</span><br><span class="line"></span><br><span class="line">filter(df,x&gt;1,y&gt;1)</span><br><span class="line"># A tibble: 1 x 2</span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">1     3     4</span><br><span class="line"></span><br><span class="line">filter(df,is.na(x) | x&gt;1,is.na(y) | y&gt;1)</span><br><span class="line"># A tibble: 2 x 2</span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">1    NA     2</span><br><span class="line">2     3     4</span><br></pre></td></tr></table></figure>

<h3 id="练习-6"><a href="#练习-6" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>Find all flights that</p>
<ol>
<li>Had an arrival delay of two or more hours</li>
<li>Flew to Houston (<code>IAH</code> or <code>HOU</code>)</li>
<li>Were operated by United, American, or Delta</li>
<li>Departed in summer (July, August, and September)</li>
<li>Arrived more than two hours late, but didn’t leave late</li>
<li>Were delayed by at least an hour, but made up over 30 minutes in flight</li>
<li>Departed between midnight and 6am (inclusive)</li>
</ol>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">filter(flights,arr_delay&gt;=<span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">filter(flights,dest==<span class="string">"IAH"</span>| dest==<span class="string">"HOU"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##运营信息要在nycflights13::airlines里面看，在flights中的carrier是缩写</span></span><br><span class="line"><span class="comment">#United（United Air Lines Inc） UA</span></span><br><span class="line"><span class="comment">#American(American Airlines Inc. ) AA</span></span><br><span class="line"><span class="comment">#Delta (Delta Air Lines Inc) DL</span></span><br><span class="line">filter(flights,carrier %<span class="keyword">in</span>% c(<span class="string">"UA"</span>,<span class="string">"AA"</span>,<span class="string">"DL"</span>))</span><br><span class="line"></span><br><span class="line">filter(flights,month%<span class="keyword">in</span>%c(<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>))</span><br><span class="line"></span><br><span class="line">filter(flights,arr_delay&gt;<span class="number">120</span> &amp; dep_delay==<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">filter(flights,(arr_delay+dep_delay)&gt;<span class="number">60</span>,air_time&gt;<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">##我们可以用summary来看dep_time的组成:</span></span><br><span class="line">summary(flights$dep_time)</span><br><span class="line"> <span class="comment">#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's </span></span><br><span class="line"> <span class="comment">#    1     907    1401    1349    1744    2400    8255 </span></span><br><span class="line"><span class="comment">#结合文档我们知道这个时间是24小时制的</span></span><br><span class="line"></span><br><span class="line">filter(flights, dep_time &lt;= <span class="number">600</span> | dep_time == <span class="number">2400</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Another useful dplyr filtering helper is <code>between()</code>. What does it do? Can you use it to simplify the code needed to answer the previous challenges?</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##between(x,a,b)表示x&gt;=a &amp; x &lt;=b</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>How many flights have a missing <code>dep_time</code>? What other variables are missing? What might these rows represent?</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filter(flights,is.na(dep_time)) %&gt;% select(flight) %&gt;% table %&gt;% length</span><br><span class="line"><span class="comment">##[1] 1906</span></span><br><span class="line"><span class="comment">#所以有1906个航班的dep——time是缺失的，说明这些航班可能被取消了</span></span><br></pre></td></tr></table></figure>

<h2 id="使用arrange-来组织行"><a href="#使用arrange-来组织行" class="headerlink" title="使用arrange()来组织行"></a>使用<code>arrange()</code>来组织行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">arrange(flights,dep_delay,sched_dep_time)</span><br><span class="line"></span><br><span class="line"># A tibble: 336,776 x 19</span><br><span class="line">    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line"> 1  2013    12     7     2040           2123       -43       40           2352</span><br><span class="line"> 2  2013     2     3     2022           2055       -33     2240           2338</span><br><span class="line"> 3  2013    11    10     1408           1440       -32     1549           1559</span><br><span class="line"> 4  2013     1    11     1900           1930       -30     2233           2243</span><br><span class="line"> 5  2013     1    29     1703           1730       -27     1947           1957</span><br><span class="line"> 6  2013     8     9      729            755       -26     1002            955</span><br><span class="line"> 7  2013    10    23     1907           1932       -25     2143           2143</span><br><span class="line"> 8  2013     3    30     2030           2055       -25     2213           2250</span><br><span class="line"> 9  2013     5    14      914            938       -24     1143           1204</span><br><span class="line">10  2013     5     5      934            958       -24     1225           1309</span><br><span class="line"># ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span><br><span class="line">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span><br><span class="line">#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span><br></pre></td></tr></table></figure>

<p>如果要降序排列，要用<code>desc()</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights,desc(dep_delay),desc(day))</span><br><span class="line"></span><br><span class="line"><span class="comment"># A tibble: 336,776 x 19</span></span><br><span class="line">    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">9</span>      <span class="number">641</span>            <span class="number">900</span>      <span class="number">1301</span>     <span class="number">1242</span>           <span class="number">1530</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">6</span>    <span class="number">15</span>     <span class="number">1432</span>           <span class="number">1935</span>      <span class="number">1137</span>     <span class="number">1607</span>           <span class="number">2120</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">10</span>     <span class="number">1121</span>           <span class="number">1635</span>      <span class="number">1126</span>     <span class="number">1239</span>           <span class="number">1810</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">9</span>    <span class="number">20</span>     <span class="number">1139</span>           <span class="number">1845</span>      <span class="number">1014</span>     <span class="number">1457</span>           <span class="number">2210</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">7</span>    <span class="number">22</span>      <span class="number">845</span>           <span class="number">1600</span>      <span class="number">1005</span>     <span class="number">1044</span>           <span class="number">1815</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">4</span>    <span class="number">10</span>     <span class="number">1100</span>           <span class="number">1900</span>       <span class="number">960</span>     <span class="number">1342</span>           <span class="number">2211</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">3</span>    <span class="number">17</span>     <span class="number">2321</span>            <span class="number">810</span>       <span class="number">911</span>      <span class="number">135</span>           <span class="number">1020</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">6</span>    <span class="number">27</span>      <span class="number">959</span>           <span class="number">1900</span>       <span class="number">899</span>     <span class="number">1236</span>           <span class="number">2226</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">7</span>    <span class="number">22</span>     <span class="number">2257</span>            <span class="number">759</span>       <span class="number">898</span>      <span class="number">121</span>           <span class="number">1026</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>    <span class="number">12</span>     <span class="number">5</span>      <span class="number">756</span>           <span class="number">1700</span>       <span class="number">896</span>     <span class="number">1058</span>           <span class="number">2020</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">df &lt;- tibble(x&#x3D;c(5,2,NA),y&#x3D;c(2,NA,6))</span><br><span class="line">df</span><br><span class="line"># A tibble: 3 x 2</span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">1     5     2</span><br><span class="line">2     2    NA</span><br><span class="line">3    NA     6</span><br><span class="line"></span><br><span class="line">arrange(df,x)</span><br><span class="line"># A tibble: 3 x 2</span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">1     2    NA</span><br><span class="line">2     5     2</span><br><span class="line">3    NA     6</span><br><span class="line"></span><br><span class="line">arrange(df,desc(x))</span><br><span class="line"># A tibble: 3 x 2</span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line">1     5     2</span><br><span class="line">2     2    NA</span><br><span class="line">3    NA     6</span><br></pre></td></tr></table></figure>

<h3 id="练习-7"><a href="#练习-7" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>How could you use <code>arrange()</code> to sort all missing values to the start? (Hint: use <code>is.na()</code>).</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">arrange(df,is.na(x))</span><br><span class="line"><span class="comment"># A tibble: 3 x 2</span></span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line"><span class="number">1</span>     <span class="number">5</span>     <span class="number">2</span></span><br><span class="line"><span class="number">2</span>     <span class="number">2</span>    <span class="literal">NA</span></span><br><span class="line"><span class="number">3</span>    <span class="literal">NA</span>     <span class="number">6</span></span><br><span class="line"></span><br><span class="line">arrange(df,desc(is.na(x)))</span><br><span class="line"><span class="comment"># A tibble: 3 x 2</span></span><br><span class="line">      x     y</span><br><span class="line">  &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line"><span class="number">1</span>    <span class="literal">NA</span>     <span class="number">6</span></span><br><span class="line"><span class="number">2</span>     <span class="number">5</span>     <span class="number">2</span></span><br><span class="line"><span class="number">3</span>     <span class="number">2</span>    <span class="literal">NA</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##注意在R中，TRUE&gt;FALSE</span></span><br></pre></td></tr></table></figure>

<h2 id="用select-选择列"><a href="#用select-选择列" class="headerlink" title="用select()选择列"></a>用<code>select()</code>选择列</h2><p>用<code>select()</code>可以选择我们想要的列</p>
<p>几个有用的函数：</p>
<ul>
<li><code>starts_with(&quot;abc&quot;)</code> 选择变量名开头是abc的变量</li>
<li><code>ends_with(&quot;abc&quot;)</code>选择变量名末尾是abc的变量</li>
<li><code>contains(&quot;abc&quot;)</code>选择变量名包含abc的变量</li>
<li><code>matches(&quot;(.)\\1&quot;)</code> 选择变量名匹配正则表达式的变量，这里是变量名含有重复字符的变量</li>
<li><code>num_range(&quot;x&quot;,1:3)</code> 选择变量x1,x2,x3</li>
</ul>
<p>当我们需要对变量重命名的时候，一般不使用<code>select()</code>，因为他会将不匹配的变量都给扔掉了；我们可以用<code>rename()</code>函数（<strong>注意，重命名的时候是new_name=old_name)</strong></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">select(flights,DAYS = day)</span><br><span class="line"><span class="comment"># A tibble: 336,776 x 1</span></span><br><span class="line">    DAYS</span><br><span class="line">   &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">2</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">3</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">4</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">5</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">6</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">7</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">8</span>     <span class="number">1</span></span><br><span class="line"> <span class="number">9</span>     <span class="number">1</span></span><br><span class="line"><span class="number">10</span>     <span class="number">1</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows</span></span><br><span class="line"></span><br><span class="line">rename(flights,DAYS = day)</span><br><span class="line"><span class="comment"># A tibble: 336,776 x 19</span></span><br><span class="line">    year month  DAYS dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>            <span class="number">515</span>         <span class="number">2</span>      <span class="number">830</span>            <span class="number">819</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>            <span class="number">529</span>         <span class="number">4</span>      <span class="number">850</span>            <span class="number">830</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>            <span class="number">540</span>         <span class="number">2</span>      <span class="number">923</span>            <span class="number">850</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>            <span class="number">545</span>        -<span class="number">1</span>     <span class="number">1004</span>           <span class="number">1022</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span>      <span class="number">812</span>            <span class="number">837</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">558</span>        -<span class="number">4</span>      <span class="number">740</span>            <span class="number">728</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>            <span class="number">600</span>        -<span class="number">5</span>      <span class="number">913</span>            <span class="number">854</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span>      <span class="number">709</span>            <span class="number">723</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span>      <span class="number">838</span>            <span class="number">846</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>            <span class="number">600</span>        -<span class="number">2</span>      <span class="number">753</span>            <span class="number">745</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows, and 11 more variables: arr_delay &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<p>另外，如果我们想要将几个变量移到数据框的前面，我们可以用<code>everything()</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">select(flights,time_hour,everything())</span><br><span class="line"><span class="comment"># A tibble: 336,776 x 19</span></span><br><span class="line">   time_hour            year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">   &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">05</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>            <span class="number">515</span>         <span class="number">2</span></span><br><span class="line"> <span class="number">2</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">05</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>            <span class="number">529</span>         <span class="number">4</span></span><br><span class="line"> <span class="number">3</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">05</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>            <span class="number">540</span>         <span class="number">2</span></span><br><span class="line"> <span class="number">4</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">05</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>            <span class="number">545</span>        -<span class="number">1</span></span><br><span class="line"> <span class="number">5</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span></span><br><span class="line"> <span class="number">6</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">05</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">558</span>        -<span class="number">4</span></span><br><span class="line"> <span class="number">7</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>            <span class="number">600</span>        -<span class="number">5</span></span><br><span class="line"> <span class="number">8</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span></span><br><span class="line"> <span class="number">9</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span></span><br><span class="line"><span class="number">10</span> <span class="number">2013</span>-<span class="number">01</span>-<span class="number">01</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>            <span class="number">600</span>        -<span class="number">2</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows, and 12 more variables: arr_time &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   hour &lt;dbl&gt;, minute &lt;dbl&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="select-变体：select-if-和select-all"><a href="#select-变体：select-if-和select-all" class="headerlink" title="select() 变体：select_if()和select_all()"></a><code>select()</code> 变体：<code>select_if()</code>和<code>select_all()</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">select_if(flights,is.character)</span><br><span class="line"># A tibble: 336,776 x 4</span><br><span class="line">   carrier tailnum origin dest </span><br><span class="line">   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;</span><br><span class="line"> 1 UA      N14228  EWR    IAH  </span><br><span class="line"> 2 UA      N24211  LGA    IAH  </span><br><span class="line"> 3 AA      N619AA  JFK    MIA  </span><br><span class="line"> 4 B6      N804JB  JFK    BQN  </span><br><span class="line"> 5 DL      N668DN  LGA    ATL  </span><br><span class="line"> 6 UA      N39463  EWR    ORD  </span><br><span class="line"> 7 B6      N516JB  EWR    FLL  </span><br><span class="line"> 8 EV      N829AS  LGA    IAD  </span><br><span class="line"> 9 B6      N593JB  JFK    MCO  </span><br><span class="line">10 AA      N3ALAA  LGA    ORD  </span><br><span class="line"># ... with 336,766 more rows</span><br><span class="line"></span><br><span class="line">select_if(flights,is.numeric) %&gt;%</span><br><span class="line">  select_if(~mean(.,na.rm &#x3D; T)&gt;10)##~表示匿名函数</span><br><span class="line">##也可以使用自定义函数</span><br><span class="line">more_than_10 &lt;- function(x)&#123;</span><br><span class="line">  mean(x,na.rm &#x3D; T)&gt;10</span><br><span class="line">&#125;</span><br><span class="line">select_if(flights,is.numeric)%&gt;%</span><br><span class="line">  select_if(more_than_10)</span><br><span class="line"># A tibble: 336,776 x 12</span><br><span class="line">    year   day dep_time sched_dep_time dep_delay arr_time sched_arr_time flight</span><br><span class="line">   &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;  &lt;int&gt;</span><br><span class="line"> 1  2013     1      517            515         2      830            819   1545</span><br><span class="line"> 2  2013     1      533            529         4      850            830   1714</span><br><span class="line"> 3  2013     1      542            540         2      923            850   1141</span><br><span class="line"> 4  2013     1      544            545        -1     1004           1022    725</span><br><span class="line"> 5  2013     1      554            600        -6      812            837    461</span><br><span class="line"> 6  2013     1      554            558        -4      740            728   1696</span><br><span class="line"> 7  2013     1      555            600        -5      913            854    507</span><br><span class="line"> 8  2013     1      557            600        -3      709            723   5708</span><br><span class="line"> 9  2013     1      557            600        -3      838            846     79</span><br><span class="line">10  2013     1      558            600        -2      753            745    301</span><br><span class="line"># ... with 336,766 more rows, and 4 more variables: air_time &lt;dbl&gt;,</span><br><span class="line">#   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">select_if(flights,is.numeric)%&gt;%</span><br><span class="line">  select_all(.,function(x)&#123;</span><br><span class="line">    paste(x,&quot;a&quot;,sep &#x3D; &quot;&quot;)</span><br><span class="line">&#125;)</span><br><span class="line"># A tibble: 336,776 x 14</span><br><span class="line">   yeara montha  daya dep_timea sched_dep_timea dep_delaya arr_timea</span><br><span class="line">   &lt;int&gt;  &lt;int&gt; &lt;int&gt;     &lt;int&gt;           &lt;int&gt;      &lt;dbl&gt;     &lt;int&gt;</span><br><span class="line"> 1  2013      1     1       517             515          2       830</span><br><span class="line"> 2  2013      1     1       533             529          4       850</span><br><span class="line"> 3  2013      1     1       542             540          2       923</span><br><span class="line"> 4  2013      1     1       544             545         -1      1004</span><br><span class="line"> 5  2013      1     1       554             600         -6       812</span><br><span class="line"> 6  2013      1     1       554             558         -4       740</span><br><span class="line"> 7  2013      1     1       555             600         -5       913</span><br><span class="line"> 8  2013      1     1       557             600         -3       709</span><br><span class="line"> 9  2013      1     1       557             600         -3       838</span><br><span class="line">10  2013      1     1       558             600         -2       753</span><br><span class="line"># ... with 336,766 more rows, and 7 more variables: sched_arr_timea &lt;int&gt;,</span><br><span class="line">#   arr_delaya &lt;dbl&gt;, flighta &lt;int&gt;, air_timea &lt;dbl&gt;, distancea &lt;dbl&gt;,</span><br><span class="line">#   houra &lt;dbl&gt;, minutea &lt;dbl&gt;</span><br></pre></td></tr></table></figure>

<h3 id="练习-8"><a href="#练习-8" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>What happens if you include the name of a variable multiple times in a <code>select()</code> call?</p>
</blockquote>
<p>如果在<code>select()</code>中出现多次同一变量名，只会显示第一次；这个行为对<code>everything()</code>是有用的，因为他忽略在everything中含有的之前的变量名，从而使得我们较简单的改变列的顺序：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select(flights,dep_delay,arr_delay,dep_delay)</span><br><span class="line"><span class="comment"># A tibble: 336,776 x 2</span></span><br><span class="line">   dep_delay arr_delay</span><br><span class="line">       &lt;dbl&gt;     &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>         <span class="number">2</span>        <span class="number">11</span></span><br><span class="line"> <span class="number">2</span>         <span class="number">4</span>        <span class="number">20</span></span><br><span class="line"> <span class="number">3</span>         <span class="number">2</span>        <span class="number">33</span></span><br><span class="line"> <span class="number">4</span>        -<span class="number">1</span>       -<span class="number">18</span></span><br><span class="line"> <span class="number">5</span>        -<span class="number">6</span>       -<span class="number">25</span></span><br><span class="line"> <span class="number">6</span>        -<span class="number">4</span>        <span class="number">12</span></span><br><span class="line"> <span class="number">7</span>        -<span class="number">5</span>        <span class="number">19</span></span><br><span class="line"> <span class="number">8</span>        -<span class="number">3</span>       -<span class="number">14</span></span><br><span class="line"> <span class="number">9</span>        -<span class="number">3</span>        -<span class="number">8</span></span><br><span class="line"><span class="number">10</span>        -<span class="number">2</span>         <span class="number">8</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>What does the <code>one_of()</code> function do? Why might it be helpful in conjunction with this vector?</p>
<figure class="highlight plain"><figcaption><span><- c("year", "month", "day", "dep_delay", "arr_delay")```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;one_of()&#96;&#96;&#96;根据字符向量来选择列，因为生成一个字符向量比一个一个打不带引号的变量名要方便：</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">a &lt;- head(colnames(flights),5)</span><br><span class="line">select(flights,one_of(a))</span><br><span class="line"># A tibble: 336,776 x 5</span><br><span class="line">   year month   day dep_time sched_dep_time</span><br><span class="line">  &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line">1  2013     1     1      517            515</span><br><span class="line">2  2013     1     1      533            529</span><br><span class="line">3  2013     1     1      542            540</span><br><span class="line">4  2013     1     1      544            545</span><br><span class="line">5  2013     1     1      554            600</span><br><span class="line">6  2013     1     1      554            558</span><br><span class="line">7  2013     1     1      555            600</span><br><span class="line">8  2013     1     1      557            600</span><br><span class="line">9  2013     1     1      557            600</span><br><span class="line">10  2013     1     1      558            600</span><br><span class="line"># ... with 336,766 more rows </span><br></pre></td></tr></table></figure>
</blockquote>
<p>另外<code>one_of()</code>的功能还可以用<code>!!!</code>来实现(当向量名与数据框中的变量名相同的时候，不同的时候可以直接用向量名)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">day &lt;- head(colnames(flights),<span class="number">5</span>)</span><br><span class="line">select(flights,!!!day)</span><br><span class="line">select(flights,one_of(day))</span><br><span class="line">select(flights,a)</span><br></pre></td></tr></table></figure>

<p>这个机制在R中叫做非标准化求值（Non-standard evaluation， NSE）</p>
<h2 id="用mutate-添加新变量"><a href="#用mutate-添加新变量" class="headerlink" title="用mutate()添加新变量"></a>用<code>mutate()</code>添加新变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">##选择数据</span><br><span class="line">flights_sm &lt;- select(flights,year:day,ends_with(&quot;delay&quot;),distance,air_time)</span><br><span class="line">##添加新列</span><br><span class="line">mutate(flights_sm,</span><br><span class="line">       gain&#x3D;dep_delay-arr_delay,</span><br><span class="line">       speed&#x3D;distance&#x2F;air_time*60,</span><br><span class="line">       gain_per_hour&#x3D;gain&#x2F;speed)</span><br><span class="line"></span><br><span class="line"># A tibble: 336,776 x 10</span><br><span class="line">    year month   day dep_delay arr_delay distance air_time  gain speed</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line"> 1  2013     1     1         2        11     1400      227    -9  370.</span><br><span class="line"> 2  2013     1     1         4        20     1416      227   -16  374.</span><br><span class="line"> 3  2013     1     1         2        33     1089      160   -31  408.</span><br><span class="line"> 4  2013     1     1        -1       -18     1576      183    17  517.</span><br><span class="line"> 5  2013     1     1        -6       -25      762      116    19  394.</span><br><span class="line"> 6  2013     1     1        -4        12      719      150   -16  288.</span><br><span class="line"> 7  2013     1     1        -5        19     1065      158   -24  404.</span><br><span class="line"> 8  2013     1     1        -3       -14      229       53    11  259.</span><br><span class="line"> 9  2013     1     1        -3        -8      944      140     5  405.</span><br><span class="line">10  2013     1     1        -2         8      733      138   -10  319.</span><br><span class="line"># ... with 336,766 more rows, and 1 more variable: gain_per_hour &lt;dbl&gt;</span><br></pre></td></tr></table></figure>

<p>如果我们只需要保存新添加的列，可以使用<code>transmute()</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">transmute(flights,</span><br><span class="line">          gain=dep_delay-arr_delay,</span><br><span class="line">          hours=air_time/<span class="number">60</span>,</span><br><span class="line">          gain_per_hour=gain/hours)</span><br><span class="line"><span class="comment"># A tibble: 336,776 x 3</span></span><br><span class="line">    gain hours gain_per_hour</span><br><span class="line">   &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>    -<span class="number">9</span> <span class="number">3.78</span>          -<span class="number">2.38</span></span><br><span class="line"> <span class="number">2</span>   -<span class="number">16</span> <span class="number">3.78</span>          -<span class="number">4.23</span></span><br><span class="line"> <span class="number">3</span>   -<span class="number">31</span> <span class="number">2.67</span>         -<span class="number">11.6</span> </span><br><span class="line"> <span class="number">4</span>    <span class="number">17</span> <span class="number">3.05</span>           <span class="number">5.57</span></span><br><span class="line"> <span class="number">5</span>    <span class="number">19</span> <span class="number">1.93</span>           <span class="number">9.83</span></span><br><span class="line"> <span class="number">6</span>   -<span class="number">16</span> <span class="number">2.5</span>           -<span class="number">6.4</span> </span><br><span class="line"> <span class="number">7</span>   -<span class="number">24</span> <span class="number">2.63</span>          -<span class="number">9.11</span></span><br><span class="line"> <span class="number">8</span>    <span class="number">11</span> <span class="number">0.883</span>         <span class="number">12.5</span> </span><br><span class="line"> <span class="number">9</span>     <span class="number">5</span> <span class="number">2.33</span>           <span class="number">2.14</span></span><br><span class="line"><span class="number">10</span>   -<span class="number">10</span> <span class="number">2.3</span>           -<span class="number">4.35</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows</span></span><br></pre></td></tr></table></figure>

<h3 id="有用的一些函数"><a href="#有用的一些函数" class="headerlink" title="有用的一些函数"></a>有用的一些函数</h3><p>利用<code>mutate()</code>来创建新的变量必须要使用向量化的函数：</p>
<ul>
<li><p>算术运算符：<code>+</code>,<code>-</code>,<code>*</code>,<code>/</code>,<code>^</code> 这些运算符采用循环的机制，即如果有一个向量比较短，则自动循环其元素使其与其他的一样长</p>
</li>
<li><p>模运算符：<code>%/%</code> 整除,<code>%%</code> 取余</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">transmute(flights,</span><br><span class="line">          dep_time,</span><br><span class="line">          hour=dep_time%/%<span class="number">100</span>,</span><br><span class="line">          minute=dep_time%%<span class="number">100</span>)</span><br><span class="line"><span class="comment"># A tibble: 336,776 x 3</span></span><br><span class="line">   dep_time  hour minute</span><br><span class="line">      &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>      <span class="number">517</span>     <span class="number">5</span>     <span class="number">17</span></span><br><span class="line"> <span class="number">2</span>      <span class="number">533</span>     <span class="number">5</span>     <span class="number">33</span></span><br><span class="line"> <span class="number">3</span>      <span class="number">542</span>     <span class="number">5</span>     <span class="number">42</span></span><br><span class="line"> <span class="number">4</span>      <span class="number">544</span>     <span class="number">5</span>     <span class="number">44</span></span><br><span class="line"> <span class="number">5</span>      <span class="number">554</span>     <span class="number">5</span>     <span class="number">54</span></span><br><span class="line"> <span class="number">6</span>      <span class="number">554</span>     <span class="number">5</span>     <span class="number">54</span></span><br><span class="line"> <span class="number">7</span>      <span class="number">555</span>     <span class="number">5</span>     <span class="number">55</span></span><br><span class="line"> <span class="number">8</span>      <span class="number">557</span>     <span class="number">5</span>     <span class="number">57</span></span><br><span class="line"> <span class="number">9</span>      <span class="number">557</span>     <span class="number">5</span>     <span class="number">57</span></span><br><span class="line"><span class="number">10</span>      <span class="number">558</span>     <span class="number">5</span>     <span class="number">58</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>logs</code> 但我们的数据跨越多个数量级的时候，我们可以用对数来转化数据，另外使用对数可以将乘转化成加</p>
</li>
<li><p>偏移窗口函数:R中的偏移函数有：<code>lead()</code>,<code>lag()</code>,<code>last()</code>,<code>first()</code>,<code>nth()</code>（注意这个前后，最前，最后是和<code>group_by</code>搭配使用</p>
<ul>
<li><p><code>lead(column,n)</code>获取当前行的下n行数据的某个字段（column）</p>
</li>
<li><p><code>lag(column,n)</code>获取当前行的前n行数据的某个字段（column）</p>
</li>
<li><p><code>last()</code>获取最晚的某一个字段的值</p>
</li>
<li><p><code>first()</code>获取最早的某一个字段的值</p>
</li>
<li><p><code>nth()</code>获取某个字段的第n个记录</p>
</li>
<li><pre><code class="R">flights%&gt;%
  group_by(year)%&gt;%
  mutate(pre_year=paste(lag(year,<span class="number">1</span>),lag(month,<span class="number">1</span>),lag(day,<span class="number">1</span>),sep = <span class="string">"-"</span>))%&gt;%
  select(pre_year,everything())
<span class="comment"># A tibble: 336,776 x 20</span>
<span class="comment"># Groups:   year [1]</span>
   pre_year  year month   day dep_time sched_dep_time dep_delay arr_time
   &lt;chr&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
 <span class="number">1</span> <span class="literal">NA</span>-<span class="literal">NA</span>-<span class="literal">NA</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>            <span class="number">515</span>         <span class="number">2</span>      <span class="number">830</span>
 <span class="number">2</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>            <span class="number">529</span>         <span class="number">4</span>      <span class="number">850</span>
 <span class="number">3</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>            <span class="number">540</span>         <span class="number">2</span>      <span class="number">923</span>
 <span class="number">4</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>            <span class="number">545</span>        -<span class="number">1</span>     <span class="number">1004</span>
 <span class="number">5</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span>      <span class="number">812</span>
 <span class="number">6</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">558</span>        -<span class="number">4</span>      <span class="number">740</span>
 <span class="number">7</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>            <span class="number">600</span>        -<span class="number">5</span>      <span class="number">913</span>
 <span class="number">8</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span>      <span class="number">709</span>
 <span class="number">9</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span>      <span class="number">838</span>
<span class="number">10</span> <span class="number">2013</span>-<span class="number">1</span>-<span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>            <span class="number">600</span>        -<span class="number">2</span>      <span class="number">753</span>
<span class="comment"># ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span>
<span class="comment">#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span>
<span class="comment">#   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span>
<span class="comment">#   time_hour &lt;dttm&gt;</span>
&lt;!--￼<span class="number">58</span>--&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
<h3 id="练习-9"><a href="#练习-9" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>Currently <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</p>
</blockquote>
<p>首先要对这两个变量的数据表现形式要了解：<code>?flights()</code></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200123164654.png" alt=""></p>
<p>我们发现这两个变量是以小时：分钟，并且是四位数的形式表示</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mutate(flights,</span><br><span class="line">       new_dep_time=((dep_time%/%<span class="number">100</span>)*<span class="number">60</span>+dep_time%%<span class="number">100</span>)%%<span class="number">1440</span>,</span><br><span class="line">       new_sched_dep_time=((sched_dep_time%/%<span class="number">100</span>)*<span class="number">60</span>+sched_dep_time%%<span class="number">100</span>)%%<span class="number">1440</span>)%&gt;%</span><br><span class="line">  select(new_dep_time,new_sched_dep_time,everything())</span><br><span class="line"><span class="comment"># A tibble: 336,776 x 21</span></span><br><span class="line">   new_dep_time new_sched_dep_t~  year month   day dep_time sched_dep_time dep_delay</span><br><span class="line">          &lt;dbl&gt;            &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>          <span class="number">317</span>              <span class="number">315</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>            <span class="number">515</span>         <span class="number">2</span></span><br><span class="line"> <span class="number">2</span>          <span class="number">333</span>              <span class="number">329</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>            <span class="number">529</span>         <span class="number">4</span></span><br><span class="line"> <span class="number">3</span>          <span class="number">342</span>              <span class="number">340</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>            <span class="number">540</span>         <span class="number">2</span></span><br><span class="line"> <span class="number">4</span>          <span class="number">344</span>              <span class="number">345</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>            <span class="number">545</span>        -<span class="number">1</span></span><br><span class="line"> <span class="number">5</span>          <span class="number">354</span>              <span class="number">360</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">600</span>        -<span class="number">6</span></span><br><span class="line"> <span class="number">6</span>          <span class="number">354</span>              <span class="number">358</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>            <span class="number">558</span>        -<span class="number">4</span></span><br><span class="line"> <span class="number">7</span>          <span class="number">355</span>              <span class="number">360</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>            <span class="number">600</span>        -<span class="number">5</span></span><br><span class="line"> <span class="number">8</span>          <span class="number">357</span>              <span class="number">360</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span></span><br><span class="line"> <span class="number">9</span>          <span class="number">357</span>              <span class="number">360</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>            <span class="number">600</span>        -<span class="number">3</span></span><br><span class="line"><span class="number">10</span>          <span class="number">358</span>              <span class="number">360</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>            <span class="number">600</span>        -<span class="number">2</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows, and 13 more variables: arr_time &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Compare <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code>. How would you expect those three numbers to be related?</p>
</blockquote>
<p>如果从字面意思上考虑，<code>dep_delay</code>=<code>dep_time</code>-<code>sched_dep_time</code> 来验证一下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">hour2min &lt;- <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  ((x%/%<span class="number">100</span>)*<span class="number">60</span>+x%%<span class="number">100</span>)%%<span class="number">1440</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a &lt;- mutate(flights,</span><br><span class="line">       new_deptime = hour2min(dep_time)-hour2min(sched_dep_time),</span><br><span class="line">       diff_deptime=new_deptime-dep_delay) %&gt;%</span><br><span class="line">  filter(diff_deptime!=<span class="number">0</span>)%&gt;%</span><br><span class="line">  select(diff_deptime,everything())</span><br><span class="line">a</span><br><span class="line"><span class="comment"># A tibble: 1,236 x 21</span></span><br><span class="line">   diff_deptime  year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time</span><br><span class="line">          &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">848</span>           <span class="number">1835</span>       <span class="number">853</span>     <span class="number">1001</span>           <span class="number">1950</span></span><br><span class="line"> <span class="number">2</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">2</span>       <span class="number">42</span>           <span class="number">2359</span>        <span class="number">43</span>      <span class="number">518</span>            <span class="number">442</span></span><br><span class="line"> <span class="number">3</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">2</span>      <span class="number">126</span>           <span class="number">2250</span>       <span class="number">156</span>      <span class="number">233</span>           <span class="number">2359</span></span><br><span class="line"> <span class="number">4</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span>       <span class="number">32</span>           <span class="number">2359</span>        <span class="number">33</span>      <span class="number">504</span>            <span class="number">442</span></span><br><span class="line"> <span class="number">5</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span>       <span class="number">50</span>           <span class="number">2145</span>       <span class="number">185</span>      <span class="number">203</span>           <span class="number">2311</span></span><br><span class="line"> <span class="number">6</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span>      <span class="number">235</span>           <span class="number">2359</span>       <span class="number">156</span>      <span class="number">700</span>            <span class="number">437</span></span><br><span class="line"> <span class="number">7</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">4</span>       <span class="number">25</span>           <span class="number">2359</span>        <span class="number">26</span>      <span class="number">505</span>            <span class="number">442</span></span><br><span class="line"> <span class="number">8</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">4</span>      <span class="number">106</span>           <span class="number">2245</span>       <span class="number">141</span>      <span class="number">201</span>           <span class="number">2356</span></span><br><span class="line"> <span class="number">9</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">5</span>       <span class="number">14</span>           <span class="number">2359</span>        <span class="number">15</span>      <span class="number">503</span>            <span class="number">445</span></span><br><span class="line"><span class="number">10</span>        -<span class="number">1440</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">5</span>       <span class="number">37</span>           <span class="number">2230</span>       <span class="number">127</span>      <span class="number">341</span>            <span class="number">131</span></span><br><span class="line"><span class="comment"># ... with 1,226 more rows, and 12 more variables: arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, new_deptime &lt;dbl&gt;</span></span><br><span class="line"></span><br><span class="line">table(a$diff_deptime)</span><br><span class="line"><span class="comment">#-1440 </span></span><br><span class="line"><span class="comment"># 1236</span></span><br></pre></td></tr></table></figure>

<p>可以看到不同的都是1440，说明相隔24个小时，也就是sched_dep_time在24点之前，而dep_time在24点之后</p>
<blockquote>
<p>Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefully read the documentation for <code>min_rank()</code></p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mutate(flights,</span><br><span class="line">       rank = min_rank(desc(dep_delay)))%&gt;%</span><br><span class="line">  select(rank,everything())%&gt;%</span><br><span class="line">  arrange(rank)</span><br><span class="line"></span><br><span class="line"><span class="comment"># A tibble: 336,776 x 20</span></span><br><span class="line">    rank  year month   day dep_time sched_dep_time dep_delay arr_time</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>     <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">9</span>      <span class="number">641</span>            <span class="number">900</span>      <span class="number">1301</span>     <span class="number">1242</span></span><br><span class="line"> <span class="number">2</span>     <span class="number">2</span>  <span class="number">2013</span>     <span class="number">6</span>    <span class="number">15</span>     <span class="number">1432</span>           <span class="number">1935</span>      <span class="number">1137</span>     <span class="number">1607</span></span><br><span class="line"> <span class="number">3</span>     <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">10</span>     <span class="number">1121</span>           <span class="number">1635</span>      <span class="number">1126</span>     <span class="number">1239</span></span><br><span class="line"> <span class="number">4</span>     <span class="number">4</span>  <span class="number">2013</span>     <span class="number">9</span>    <span class="number">20</span>     <span class="number">1139</span>           <span class="number">1845</span>      <span class="number">1014</span>     <span class="number">1457</span></span><br><span class="line"> <span class="number">5</span>     <span class="number">5</span>  <span class="number">2013</span>     <span class="number">7</span>    <span class="number">22</span>      <span class="number">845</span>           <span class="number">1600</span>      <span class="number">1005</span>     <span class="number">1044</span></span><br><span class="line"> <span class="number">6</span>     <span class="number">6</span>  <span class="number">2013</span>     <span class="number">4</span>    <span class="number">10</span>     <span class="number">1100</span>           <span class="number">1900</span>       <span class="number">960</span>     <span class="number">1342</span></span><br><span class="line"> <span class="number">7</span>     <span class="number">7</span>  <span class="number">2013</span>     <span class="number">3</span>    <span class="number">17</span>     <span class="number">2321</span>            <span class="number">810</span>       <span class="number">911</span>      <span class="number">135</span></span><br><span class="line"> <span class="number">8</span>     <span class="number">8</span>  <span class="number">2013</span>     <span class="number">6</span>    <span class="number">27</span>      <span class="number">959</span>           <span class="number">1900</span>       <span class="number">899</span>     <span class="number">1236</span></span><br><span class="line"> <span class="number">9</span>     <span class="number">9</span>  <span class="number">2013</span>     <span class="number">7</span>    <span class="number">22</span>     <span class="number">2257</span>            <span class="number">759</span>       <span class="number">898</span>      <span class="number">121</span></span><br><span class="line"><span class="number">10</span>    <span class="number">10</span>  <span class="number">2013</span>    <span class="number">12</span>     <span class="number">5</span>      <span class="number">756</span>           <span class="number">1700</span>       <span class="number">896</span>     <span class="number">1058</span></span><br><span class="line"><span class="comment"># ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,</span></span><br><span class="line"><span class="comment">#   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span><br><span class="line"><span class="comment">#   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,</span></span><br><span class="line"><span class="comment">#   time_hour &lt;dttm&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过看答案，知道了还有2个排序的函数：<code>row_number()</code>,<code>min_rank()</code>,<code>dense_rank()</code> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;R</span><br><span class="line">rankme &lt;- tibble(x&#x3D;c(10,5,1,5,5))</span><br><span class="line">rankme &lt;- mutate(rankme,</span><br><span class="line">                 x_row_number &#x3D; row_number(x),</span><br><span class="line">                 x_min_rank &#x3D; min_rank(x),</span><br><span class="line">                 x_dense_rank &#x3D; dense_rank(x))</span><br><span class="line">arrange(rankme,x)</span><br><span class="line"># A tibble: 5 x 4</span><br><span class="line">      x x_row_number x_min_rank x_dense_rank</span><br><span class="line">  &lt;dbl&gt;        &lt;int&gt;      &lt;int&gt;        &lt;int&gt;</span><br><span class="line">1     1            1          1            1</span><br><span class="line">2     5            2          2            2</span><br><span class="line">3     5            3          2            2</span><br><span class="line">4     5            4          2            2</span><br><span class="line">5    10            5          5            3</span><br></pre></td></tr></table></figure>

<blockquote>
<p>What does <code>1:3 + 1:10</code> return? Why?</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>:<span class="number">3</span> + <span class="number">1</span>:<span class="number">10</span></span><br><span class="line"></span><br><span class="line">[<span class="number">1</span>]  <span class="number">2</span>  <span class="number">4</span>  <span class="number">6</span>  <span class="number">5</span>  <span class="number">7</span>  <span class="number">9</span>  <span class="number">8</span> <span class="number">10</span> <span class="number">12</span> <span class="number">11</span></span><br><span class="line">Warning message:</span><br><span class="line">In <span class="number">1</span>:<span class="number">3</span> + <span class="number">1</span>:<span class="number">10</span> :</span><br><span class="line">  longer object length is not a multiple of shorter object length</span><br></pre></td></tr></table></figure>

<p>当两个向量不一样长的时候，做运算时会循环短的向量</p>
<h2 id="使用summarise-进行分组汇总"><a href="#使用summarise-进行分组汇总" class="headerlink" title="使用summarise()进行分组汇总"></a>使用<code>summarise()</code>进行分组汇总</h2><p>和<code>group_by()</code>联合使用更强大：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">summarise(flights,delay=mean(dep_delay,na.rm = <span class="literal">T</span>))</span><br><span class="line"><span class="comment">##将所有的离开延迟的时间求了平均值，但是这个提供不了太多的信息</span></span><br><span class="line"><span class="comment"># A tibble: 1 x 1</span></span><br><span class="line">  delay</span><br><span class="line">  &lt;dbl&gt;</span><br><span class="line"><span class="number">1</span>  <span class="number">12.6</span></span><br><span class="line"></span><br><span class="line">by_day &lt;- group_by(flights,year,month,day)<span class="comment">##按照不同的日期进行分组</span></span><br><span class="line">summarise(by_day,delay=mean(dep_delay,na.rm = <span class="literal">T</span>))</span><br><span class="line"><span class="comment"># A tibble: 365 x 4</span></span><br><span class="line"><span class="comment"># Groups:   year, month [12]</span></span><br><span class="line">    year month   day delay</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span> <span class="number">11.5</span> </span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">2</span> <span class="number">13.9</span> </span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span> <span class="number">11.0</span> </span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">4</span>  <span class="number">8.95</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">5</span>  <span class="number">5.73</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">6</span>  <span class="number">7.15</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">7</span>  <span class="number">5.42</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">8</span>  <span class="number">2.55</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">9</span>  <span class="number">2.28</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">10</span>  <span class="number">2.84</span></span><br><span class="line"><span class="comment"># ... with 355 more rows</span></span><br></pre></td></tr></table></figure>

<h3 id="利用管道（pipe）来连接多步操作"><a href="#利用管道（pipe）来连接多步操作" class="headerlink" title="利用管道（pipe）来连接多步操作"></a>利用管道（pipe）来连接多步操作</h3><p>例如我们想要探索对于每一个目的地，距离与平均延误时间的关系</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">delays &lt;- flights %&gt;% </span><br><span class="line">  group_by(dest) %&gt;%</span><br><span class="line">  summarise(</span><br><span class="line">    count=n(),</span><br><span class="line">    dist=mean(distance,na.rm = <span class="literal">T</span>),</span><br><span class="line">    delay=mean(arr_delay,na.rm = <span class="literal">T</span>)</span><br><span class="line">  ) %&gt;%</span><br><span class="line">  filter(count&gt;<span class="number">20</span>,dest!=<span class="string">"HNL"</span>)</span><br><span class="line">delays</span><br><span class="line"></span><br><span class="line"><span class="comment"># A tibble: 96 x 4</span></span><br><span class="line">   dest  count  dist delay</span><br><span class="line">   &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span> ABQ     <span class="number">254</span> <span class="number">1826</span>   <span class="number">4.38</span></span><br><span class="line"> <span class="number">2</span> ACK     <span class="number">265</span>  <span class="number">199</span>   <span class="number">4.85</span></span><br><span class="line"> <span class="number">3</span> ALB     <span class="number">439</span>  <span class="number">143</span>  <span class="number">14.4</span> </span><br><span class="line"> <span class="number">4</span> ATL   <span class="number">17215</span>  <span class="number">757.</span> <span class="number">11.3</span> </span><br><span class="line"> <span class="number">5</span> AUS    <span class="number">2439</span> <span class="number">1514.</span>  <span class="number">6.02</span></span><br><span class="line"> <span class="number">6</span> AVL     <span class="number">275</span>  <span class="number">584.</span>  <span class="number">8.00</span></span><br><span class="line"> <span class="number">7</span> BDL     <span class="number">443</span>  <span class="number">116</span>   <span class="number">7.05</span></span><br><span class="line"> <span class="number">8</span> BGR     <span class="number">375</span>  <span class="number">378</span>   <span class="number">8.03</span></span><br><span class="line"> <span class="number">9</span> BHM     <span class="number">297</span>  <span class="number">866.</span> <span class="number">16.9</span> </span><br><span class="line"><span class="number">10</span> BNA    <span class="number">6333</span>  <span class="number">758.</span> <span class="number">11.8</span> </span><br><span class="line"><span class="comment"># ... with 86 more rows</span></span><br><span class="line"></span><br><span class="line">ggplot(data = delays,mapping = aes(x=dist,y=delay))+</span><br><span class="line">  geom_point(aes(size=count),alpha=<span class="number">1</span>/<span class="number">3</span>)+</span><br><span class="line">  geom_smooth(se=<span class="literal">FALSE</span>)<span class="comment">##不加置信区间</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201100436.png" alt=""></p>
<h3 id="数目-n"><a href="#数目-n" class="headerlink" title="数目 n()"></a>数目 <code>n()</code></h3><p>检查样本的大小，避免基于小数据做出结论</p>
<p>比如，当我们查看不同航班的平均延误时间的时候：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled &lt;- flights %&gt;%</span><br><span class="line">  filter(!is.na(dep_delay),!is.na(arr_delay))</span><br><span class="line">delays &lt;- not_cancelled %&gt;% </span><br><span class="line">  group_by(tailnum) %&gt;%</span><br><span class="line">  summarise(</span><br><span class="line">    delay=mean(arr_delay)</span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">ggplot(data = delays,mapping = aes(x=delay))+</span><br><span class="line">  geom_freqpoly(binwidth=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">delays1 &lt;- not_cancelled %&gt;% </span><br><span class="line">  group_by(tailnum) %&gt;%</span><br><span class="line">  summarise(</span><br><span class="line">    delay=mean(arr_delay),</span><br><span class="line">    n=n()</span><br><span class="line">  )</span><br><span class="line">ggplot(data = delays1,mapping = aes(x=n,y=delay))+</span><br><span class="line">  geom_point(alpha=<span class="number">1</span>/<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201111417.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201111534.png" alt=""></p>
<p>我们发现数目比较少的航班的延误时间差异比较大；实际上当我们画任何一个汇总数据和分组大小的图的时候，都会发现随着样本量的增加差异会逐渐变小，所以我们在分析数据的时候应该将这些差异较大的样本量少的数据删除：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delays1 %&gt;%</span><br><span class="line">  filter(n&gt;<span class="number">25</span>) %&gt;%</span><br><span class="line">  ggplot(mapping = aes(x=n,y=delay))+</span><br><span class="line">  geom_point(alpha=<span class="number">1</span>/<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200201111909.png" alt=""></p>
<h3 id="有用的汇总函数"><a href="#有用的汇总函数" class="headerlink" title="有用的汇总函数"></a>有用的汇总函数</h3><ul>
<li><p>数据离散程度：<code>sd()</code>,<code>IQR()</code>, <code>mad()</code> ,分别是标准差，四分位距（即第一个四分位数和第三个四分位数的差，Q1-Q3），绝对中位差（即先算出数据与他们的中位数的偏差，再计算这些偏差的绝对值的中位数），这些函数在处理离群值的时候有用</p>
</li>
<li><p>大小的函数：<code>min()</code>, <code>max()</code>, <code>quantile(x,n)</code> (分位数，如<code>quantile(x,0.25))</code>表示在向量x中找到一个数使其大于x中25%的数，小于x中75%的数）</p>
</li>
<li><p>位置函数：<code>first()</code>, <code>last()</code>, <code>nth(x,2)</code> </p>
</li>
<li><p>计数函数：<code>n()</code>不用加参数，返回当前gruop的大小；如果我们要对非缺失值进行计数，可以使用<code>sum(!is.na(x))</code> ;还可以用<code>n_distinct(x)</code>对唯一值进行计数（注意，这个是包括NA的，要不对NA计数可以用na.rm=T);dplyr还提供了一个<code>count()</code>函数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled %&gt;%</span><br><span class="line">  count(dest)</span><br><span class="line"><span class="comment"># A tibble: 104 x 2</span></span><br><span class="line">   dest      n</span><br><span class="line">   &lt;chr&gt; &lt;int&gt;</span><br><span class="line"> <span class="number">1</span> ABQ     <span class="number">254</span></span><br><span class="line"> <span class="number">2</span> ACK     <span class="number">264</span></span><br><span class="line"> <span class="number">3</span> ALB     <span class="number">418</span></span><br><span class="line"> <span class="number">4</span> ANC       <span class="number">8</span></span><br><span class="line"> <span class="number">5</span> ATL   <span class="number">16837</span></span><br><span class="line"> <span class="number">6</span> AUS    <span class="number">2411</span></span><br><span class="line"> <span class="number">7</span> AVL     <span class="number">261</span></span><br><span class="line"> <span class="number">8</span> BDL     <span class="number">412</span></span><br><span class="line"> <span class="number">9</span> BGR     <span class="number">358</span></span><br><span class="line"><span class="number">10</span> BHM     <span class="number">269</span></span><br><span class="line"><span class="comment"># ... with 94 more rows</span></span><br></pre></td></tr></table></figure>

<p><code>count()</code>函数不但可以计算，还可以用参数<code>wt</code>来汇总其他的变量（sum）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled %&gt;%</span><br><span class="line">  count(tailnum,wt=distance)</span><br><span class="line"><span class="comment"># A tibble: 4,037 x 2</span></span><br><span class="line">   tailnum      n</span><br><span class="line">   &lt;chr&gt;    &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span> D942DN    <span class="number">3418</span></span><br><span class="line"> <span class="number">2</span> N0EGMQ  <span class="number">239143</span></span><br><span class="line"> <span class="number">3</span> N10156  <span class="number">109664</span></span><br><span class="line"> <span class="number">4</span> N102UW   <span class="number">25722</span></span><br><span class="line"> <span class="number">5</span> N103US   <span class="number">24619</span></span><br><span class="line"> <span class="number">6</span> N104UW   <span class="number">24616</span></span><br><span class="line"> <span class="number">7</span> N10575  <span class="number">139903</span></span><br><span class="line"> <span class="number">8</span> N105UW   <span class="number">23618</span></span><br><span class="line"> <span class="number">9</span> N107US   <span class="number">21677</span></span><br><span class="line"><span class="number">10</span> N108UW   <span class="number">32070</span></span><br><span class="line"><span class="comment"># ... with 4,027 more rows</span></span><br></pre></td></tr></table></figure>

<p>其实<code>count()</code>相当于<code>group_by()</code>加上<code>tally()</code> :</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled %&gt;% </span><br><span class="line">  group_by(tailnum) %&gt;%</span><br><span class="line">  tally(wt=distance)</span><br><span class="line"><span class="comment"># A tibble: 4,037 x 2</span></span><br><span class="line">   tailnum      n</span><br><span class="line">   &lt;chr&gt;    &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span> D942DN    <span class="number">3418</span></span><br><span class="line"> <span class="number">2</span> N0EGMQ  <span class="number">239143</span></span><br><span class="line"> <span class="number">3</span> N10156  <span class="number">109664</span></span><br><span class="line"> <span class="number">4</span> N102UW   <span class="number">25722</span></span><br><span class="line"> <span class="number">5</span> N103US   <span class="number">24619</span></span><br><span class="line"> <span class="number">6</span> N104UW   <span class="number">24616</span></span><br><span class="line"> <span class="number">7</span> N10575  <span class="number">139903</span></span><br><span class="line"> <span class="number">8</span> N105UW   <span class="number">23618</span></span><br><span class="line"> <span class="number">9</span> N107US   <span class="number">21677</span></span><br><span class="line"><span class="number">10</span> N108UW   <span class="number">32070</span></span><br><span class="line"><span class="comment"># ... with 4,027 more rows</span></span><br></pre></td></tr></table></figure>

<p><code>count()</code>还有<code>sort</code>参数，相当于<code>count()</code>加上<code>arrange(n)</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">flights %&gt;% count(dest,sort = <span class="literal">T</span>)</span><br><span class="line">flights %&gt;% </span><br><span class="line">  group_by(dest) %&gt;%</span><br><span class="line">  tally() %&gt;%</span><br><span class="line">  arrange(desc(n)) </span><br><span class="line"><span class="comment"># A tibble: 105 x 2</span></span><br><span class="line">   dest      n</span><br><span class="line">   &lt;chr&gt; &lt;int&gt;</span><br><span class="line"> <span class="number">1</span> ORD   <span class="number">17283</span></span><br><span class="line"> <span class="number">2</span> ATL   <span class="number">17215</span></span><br><span class="line"> <span class="number">3</span> LAX   <span class="number">16174</span></span><br><span class="line"> <span class="number">4</span> BOS   <span class="number">15508</span></span><br><span class="line"> <span class="number">5</span> MCO   <span class="number">14082</span></span><br><span class="line"> <span class="number">6</span> CLT   <span class="number">14064</span></span><br><span class="line"> <span class="number">7</span> SFO   <span class="number">13331</span></span><br><span class="line"> <span class="number">8</span> FLL   <span class="number">12055</span></span><br><span class="line"> <span class="number">9</span> MIA   <span class="number">11728</span></span><br><span class="line"><span class="number">10</span> DCA    <span class="number">9705</span></span><br><span class="line"><span class="comment"># ... with 95 more rows</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>利用逻辑运算符和<code>sum()</code> <code>mean()</code>计算数量和比例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##有多少的航班是在5点前离开的</span></span><br><span class="line">not_cancelled %&gt;%</span><br><span class="line">  group_by(year,month,day) %&gt;%</span><br><span class="line">  summarise(n_early = sum(dep_time&lt;<span class="number">500</span>))</span><br><span class="line"><span class="comment"># A tibble: 365 x 4</span></span><br><span class="line"><span class="comment"># Groups:   year, month [12]</span></span><br><span class="line">    year month   day n_early</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>       <span class="number">0</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">2</span>       <span class="number">3</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span>       <span class="number">4</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">4</span>       <span class="number">3</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">5</span>       <span class="number">3</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">6</span>       <span class="number">2</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">7</span>       <span class="number">2</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">8</span>       <span class="number">1</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">9</span>       <span class="number">3</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">10</span>       <span class="number">3</span></span><br><span class="line"><span class="comment"># ... with 355 more rows</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##有多少航班延误超过1个小时</span></span><br><span class="line">not_cancelled %&gt;%</span><br><span class="line">  group_by(year,month,day) %&gt;%</span><br><span class="line">  summarise(hour_prop = mean(arr_delay&gt;<span class="number">60</span>))</span><br><span class="line"><span class="comment"># A tibble: 365 x 4</span></span><br><span class="line"><span class="comment"># Groups:   year, month [12]</span></span><br><span class="line">    year month   day hour_prop</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>    <span class="number">0.0722</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">2</span>    <span class="number">0.0851</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span>    <span class="number">0.0567</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">4</span>    <span class="number">0.0396</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">5</span>    <span class="number">0.0349</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">6</span>    <span class="number">0.0470</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">7</span>    <span class="number">0.0333</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">8</span>    <span class="number">0.0213</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">9</span>    <span class="number">0.0202</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">10</span>    <span class="number">0.0183</span></span><br><span class="line"><span class="comment"># ... with 355 more rows</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="对多个变量进行分组"><a href="#对多个变量进行分组" class="headerlink" title="对多个变量进行分组"></a>对多个变量进行分组</h3><p>当我们进行逐步汇总的时候，变量会依次减少：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">daily &lt;- group_by(flights,year,month,day)</span><br><span class="line">per_day &lt;- summarise(daily,flights=n())</span><br><span class="line"><span class="comment"># A tibble: 365 x 4</span></span><br><span class="line"><span class="comment"># Groups:   year, month [12]</span></span><br><span class="line">    year month   day flights</span><br><span class="line">   &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>     <span class="number">842</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">943</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span>     <span class="number">914</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">4</span>     <span class="number">915</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">5</span>     <span class="number">720</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">6</span>     <span class="number">832</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">7</span>     <span class="number">933</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">8</span>     <span class="number">899</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">9</span>     <span class="number">902</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">10</span>     <span class="number">932</span></span><br><span class="line"><span class="comment"># ... with 355 more rows</span></span><br><span class="line"></span><br><span class="line">per_month &lt;- summarise(per_day,flights=sum(flights))</span><br><span class="line"><span class="comment"># A tibble: 12 x 3</span></span><br><span class="line"><span class="comment"># Groups:   year [1]</span></span><br><span class="line">    year month flights</span><br><span class="line">   &lt;int&gt; &lt;int&gt;   &lt;int&gt;</span><br><span class="line"> <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>   <span class="number">27004</span></span><br><span class="line"> <span class="number">2</span>  <span class="number">2013</span>     <span class="number">2</span>   <span class="number">24951</span></span><br><span class="line"> <span class="number">3</span>  <span class="number">2013</span>     <span class="number">3</span>   <span class="number">28834</span></span><br><span class="line"> <span class="number">4</span>  <span class="number">2013</span>     <span class="number">4</span>   <span class="number">28330</span></span><br><span class="line"> <span class="number">5</span>  <span class="number">2013</span>     <span class="number">5</span>   <span class="number">28796</span></span><br><span class="line"> <span class="number">6</span>  <span class="number">2013</span>     <span class="number">6</span>   <span class="number">28243</span></span><br><span class="line"> <span class="number">7</span>  <span class="number">2013</span>     <span class="number">7</span>   <span class="number">29425</span></span><br><span class="line"> <span class="number">8</span>  <span class="number">2013</span>     <span class="number">8</span>   <span class="number">29327</span></span><br><span class="line"> <span class="number">9</span>  <span class="number">2013</span>     <span class="number">9</span>   <span class="number">27574</span></span><br><span class="line"><span class="number">10</span>  <span class="number">2013</span>    <span class="number">10</span>   <span class="number">28889</span></span><br><span class="line"><span class="number">11</span>  <span class="number">2013</span>    <span class="number">11</span>   <span class="number">27268</span></span><br><span class="line"><span class="number">12</span>  <span class="number">2013</span>    <span class="number">12</span>   <span class="number">28135</span></span><br><span class="line"></span><br><span class="line">per_year &lt;- summarise(per_month,flights=sum(flights))</span><br><span class="line"><span class="comment"># A tibble: 1 x 2</span></span><br><span class="line">   year flights</span><br><span class="line">  &lt;int&gt;   &lt;int&gt;</span><br><span class="line"><span class="number">1</span>  <span class="number">2013</span>  <span class="number">336776</span></span><br></pre></td></tr></table></figure>

<h3 id="ungroup-取消分组"><a href="#ungroup-取消分组" class="headerlink" title="ungroup()取消分组"></a><code>ungroup()</code>取消分组</h3><h3 id="练习-10"><a href="#练习-10" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>Come up with another approach that will give you the same output as <code>not_cancelled %&gt;% count(dest)</code> and <code>not_cancelled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>).</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled %&gt;% count(dest)</span><br><span class="line"><span class="comment">##可以用其他的方法：</span></span><br><span class="line">not_cancelled %&gt;% group_by(dest) %&gt;% summarise(n=length(dest))</span><br><span class="line"></span><br><span class="line">not_cancelled %&gt;% group_by(dest) %&gt;% summarise(n=n())</span><br><span class="line"></span><br><span class="line">not_cancelled %&gt;% group_by(dest) %&gt;% tally()</span><br><span class="line"><span class="comment"># A tibble: 104 x 2</span></span><br><span class="line">   dest      n</span><br><span class="line">   &lt;chr&gt; &lt;int&gt;</span><br><span class="line"> <span class="number">1</span> ABQ     <span class="number">254</span></span><br><span class="line"> <span class="number">2</span> ACK     <span class="number">264</span></span><br><span class="line"> <span class="number">3</span> ALB     <span class="number">418</span></span><br><span class="line"> <span class="number">4</span> ANC       <span class="number">8</span></span><br><span class="line"> <span class="number">5</span> ATL   <span class="number">16837</span></span><br><span class="line"> <span class="number">6</span> AUS    <span class="number">2411</span></span><br><span class="line"> <span class="number">7</span> AVL     <span class="number">261</span></span><br><span class="line"> <span class="number">8</span> BDL     <span class="number">412</span></span><br><span class="line"> <span class="number">9</span> BGR     <span class="number">358</span></span><br><span class="line"><span class="number">10</span> BHM     <span class="number">269</span></span><br><span class="line"><span class="comment"># ... with 94 more rows</span></span><br></pre></td></tr></table></figure>

<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">not_cancelled %&gt;% count(tailnum,wt=distance)</span><br><span class="line"><span class="comment">##其他的方法：</span></span><br><span class="line">not_cancelled %&gt;% group_by(tailnum) %&gt;% tally(wt=distance)</span><br><span class="line"></span><br><span class="line">not_cancelled %&gt;% group_by(tailnum) %&gt;% summarise(n=sum(distance))</span><br><span class="line"><span class="comment"># A tibble: 4,037 x 2</span></span><br><span class="line">   tailnum      n</span><br><span class="line">   &lt;chr&gt;    &lt;dbl&gt;</span><br><span class="line"> <span class="number">1</span> D942DN    <span class="number">3418</span></span><br><span class="line"> <span class="number">2</span> N0EGMQ  <span class="number">239143</span></span><br><span class="line"> <span class="number">3</span> N10156  <span class="number">109664</span></span><br><span class="line"> <span class="number">4</span> N102UW   <span class="number">25722</span></span><br><span class="line"> <span class="number">5</span> N103US   <span class="number">24619</span></span><br><span class="line"> <span class="number">6</span> N104UW   <span class="number">24616</span></span><br><span class="line"> <span class="number">7</span> N10575  <span class="number">139903</span></span><br><span class="line"> <span class="number">8</span> N105UW   <span class="number">23618</span></span><br><span class="line"> <span class="number">9</span> N107US   <span class="number">21677</span></span><br><span class="line"><span class="number">10</span> N108UW   <span class="number">32070</span></span><br><span class="line"><span class="comment"># ... with 4,027 more rows</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##把average delay算作arr_delay和dep_delay的平均，再把每一天所有航班的相加</span></span><br><span class="line">cancelled_per_day &lt;-flights %&gt;%</span><br><span class="line">                    mutate(can=(is.na(dep_delay) | is.na(arr_delay)),ave_delay=(arr_delay+dep_delay)/<span class="number">2</span>) %&gt;%</span><br><span class="line">                    select(year,month,day,can,arr_delay,dep_delay,ave_delay) %&gt;%</span><br><span class="line">                    group_by(year,month,day) %&gt;%</span><br><span class="line"> summarise(flights_num=n(),cancelled_num=sum(can),cancelled_par=cancelled_num/flights_num,ave_delayall=sum(ave_delay,na.rm = <span class="literal">T</span>))</span><br><span class="line"></span><br><span class="line">ggplot(cancelled_per_day) +</span><br><span class="line">  geom_point(aes(x=flights_num,y=cancelled_num))</span><br><span class="line"></span><br><span class="line">ggplot(cancelled_per_day) +</span><br><span class="line">  geom_point(aes(x=ave_delayall,y=cancelled_num))</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200212190839.png" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200212190723.png" alt=""></p>
<h2 id="Grouped-mutates-and-filters"><a href="#Grouped-mutates-and-filters" class="headerlink" title="Grouped mutates (and filters)"></a>Grouped mutates (and filters)</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">flights_sm &lt;- select(flights,year:day,ends_with(<span class="string">"delay"</span>),distance,air_time)</span><br><span class="line"><span class="comment">#将每一组延误最多的航班找出来</span></span><br><span class="line">flights_sm %&gt;%</span><br><span class="line">  group_by(year,month,day) %&gt;%</span><br><span class="line">  filter(rank(desc(arr_delay))&lt;<span class="number">10</span>)</span><br><span class="line"><span class="comment">##A grouped filter is a grouped mutate followed by an ungrouped filter</span></span><br><span class="line">flights_sm %&gt;%</span><br><span class="line">  group_by(year,month,day) %&gt;%</span><br><span class="line">  mutate(rank = rank(desc(arr_delay))) %&gt;%</span><br><span class="line">  ungroup() %&gt;%</span><br><span class="line">  filter(rank&lt;<span class="number">10</span>) %&gt;%</span><br><span class="line">  select(-rank)</span><br><span class="line"></span><br><span class="line">popular_dests &lt;- flights %&gt;%</span><br><span class="line">  group_by(dest) %&gt;%</span><br><span class="line">  filter(n()&gt;<span class="number">365</span>)</span><br><span class="line"></span><br><span class="line">popular_dests %&gt;%</span><br><span class="line">  filter(arr_delay&gt;<span class="number">0</span>) %&gt;%</span><br><span class="line">  mutate(prop_delay=arr_delay/sum(arr_delay)) %&gt;%</span><br><span class="line">  select(year:day,dest,arr_delay,prop_delay)</span><br></pre></td></tr></table></figure>

<h3 id="练习-11"><a href="#练习-11" class="headerlink" title="练习"></a>练习</h3><h1 id="Exploratory-Data-Analysis"><a href="#Exploratory-Data-Analysis" class="headerlink" title="Exploratory Data Analysis"></a>Exploratory Data Analysis</h1><p>探索性的数据分析是为了更好的理解我们的数据，做EDA的最简单的方法就是用问题作为我们探索数据的导向。对于问什么问题没有一个准则，每一个问题都可能聚焦在数据的不同方面，不同子集；但是有两类问题在探索发现数据中常常是有帮助的：</p>
<ul>
<li>在变量之内有什么样的variation?</li>
<li>在变量之间有什么样的covariation?</li>
</ul>
<p>本章就是围绕回答这两个问题展开</p>
<h2 id="Variation"><a href="#Variation" class="headerlink" title="Variation"></a>Variation</h2><p>变异（Variation）就是变量的值在不同的测量(measurement)中会改变的趋势,理解变异最直观的方式就是作图来展示变量值的分布</p>
<h3 id="Visualising-distributions"><a href="#Visualising-distributions" class="headerlink" title="Visualising distributions"></a>Visualising distributions</h3><p>怎么样去可视化变量取决于变量是分类变量还是连续变量，对于分类变量，可以用bar chart：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x=cut))</span><br><span class="line"><span class="comment">##y轴就等于count()创建的一个变量</span></span><br><span class="line">diamonds %&gt;%</span><br><span class="line">  count(cut)</span><br><span class="line"><span class="comment"># # A tibble: 5 x 2</span></span><br><span class="line"><span class="comment"># cut           n</span></span><br><span class="line"><span class="comment"># &lt;ord&gt;     &lt;int&gt;</span></span><br><span class="line"><span class="comment"># 1 Fair       1610</span></span><br><span class="line"><span class="comment"># 2 Good       4906</span></span><br><span class="line"><span class="comment"># 3 Very Good 12082</span></span><br><span class="line"><span class="comment"># 4 Premium   13791</span></span><br><span class="line"><span class="comment"># 5 Ideal     21551</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wt12318/picgo/master/img/20200225135247.png" alt=""></p>
<p>而对于连续型的变量，我们可以用直方图来看数据的分布：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item"></div>
      <div class="post-nav-item">
    <a href="/2020/02/25/%E7%BB%9F%E8%AE%A1%E5%AD%A6%E4%B9%A0/" rel="next" title="统计学习">
      统计学习 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Data-visualisation"><span class="nav-number">1.</span> <span class="nav-text">Data visualisation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Aesthetic-mappings"><span class="nav-number">1.1.</span> <span class="nav-text">Aesthetic mappings</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习"><span class="nav-number">1.1.1.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Facts"><span class="nav-number">1.2.</span> <span class="nav-text">Facts</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Geometric-objects"><span class="nav-number">1.3.</span> <span class="nav-text">Geometric objects</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-2"><span class="nav-number">1.3.1.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Statistical-transformations"><span class="nav-number">1.4.</span> <span class="nav-text">Statistical transformations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-3"><span class="nav-number">1.4.1.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Position-adjustments"><span class="nav-number">1.5.</span> <span class="nav-text">Position adjustments</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-4"><span class="nav-number">1.5.1.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Coordinate-systems"><span class="nav-number">1.6.</span> <span class="nav-text">Coordinate systems</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-5"><span class="nav-number">1.6.1.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-layered-grammar-of-graphics"><span class="nav-number">1.7.</span> <span class="nav-text">The layered grammar of graphics</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Data-transformation"><span class="nav-number">2.</span> <span class="nav-text">Data transformation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用filter-来过滤行"><span class="nav-number">2.1.</span> <span class="nav-text">使用filter()来过滤行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Comparisons"><span class="nav-number">2.1.1.</span> <span class="nav-text">Comparisons</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Logical-operators"><span class="nav-number">2.1.2.</span> <span class="nav-text">Logical operators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Missing-values"><span class="nav-number">2.1.3.</span> <span class="nav-text">Missing values</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-6"><span class="nav-number">2.1.4.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用arrange-来组织行"><span class="nav-number">2.2.</span> <span class="nav-text">使用arrange()来组织行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-7"><span class="nav-number">2.2.1.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用select-选择列"><span class="nav-number">2.3.</span> <span class="nav-text">用select()选择列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#select-变体：select-if-和select-all"><span class="nav-number">2.3.1.</span> <span class="nav-text">select() 变体：select_if()和select_all()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-8"><span class="nav-number">2.3.2.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用mutate-添加新变量"><span class="nav-number">2.4.</span> <span class="nav-text">用mutate()添加新变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#有用的一些函数"><span class="nav-number">2.4.1.</span> <span class="nav-text">有用的一些函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-9"><span class="nav-number">2.4.2.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用summarise-进行分组汇总"><span class="nav-number">2.5.</span> <span class="nav-text">使用summarise()进行分组汇总</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#利用管道（pipe）来连接多步操作"><span class="nav-number">2.5.1.</span> <span class="nav-text">利用管道（pipe）来连接多步操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数目-n"><span class="nav-number">2.5.2.</span> <span class="nav-text">数目 n()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#有用的汇总函数"><span class="nav-number">2.5.3.</span> <span class="nav-text">有用的汇总函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对多个变量进行分组"><span class="nav-number">2.5.4.</span> <span class="nav-text">对多个变量进行分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ungroup-取消分组"><span class="nav-number">2.5.5.</span> <span class="nav-text">ungroup()取消分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-10"><span class="nav-number">2.5.6.</span> <span class="nav-text">练习</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grouped-mutates-and-filters"><span class="nav-number">2.6.</span> <span class="nav-text">Grouped mutates (and filters)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习-11"><span class="nav-number">2.6.1.</span> <span class="nav-text">练习</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exploratory-Data-Analysis"><span class="nav-number">3.</span> <span class="nav-text">Exploratory Data Analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Variation"><span class="nav-number">3.1.</span> <span class="nav-text">Variation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Visualising-distributions"><span class="nav-number">3.1.1.</span> <span class="nav-text">Visualising distributions</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Wu tao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wu tao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.1
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
